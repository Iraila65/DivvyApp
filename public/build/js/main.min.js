(()=>{var e={724:()=>{!function(){const e=document.querySelector(".grupo-conectado"),t=document.querySelector(".dashboard__grafica");let n=[];t&&async function(){const t="/api/movimientos/gastos?url="+e.value,o=await fetch(t),a=await o.json(),i=Object.values(a),c=i[0],s=i[1],d=i[2],r=i[3],l=i[4],m=Object.keys(c),u=[],p=[],h=[],b=[],f=[],g=[];let v=l.reduce((e,t)=>{const{concepto:n,importe:o}=t;return e[n]=(e[n]||0)+o,e},{});const y=Object.keys(v),_=Object.values(v);let S=l.reduce((e,t)=>{const{nombre:n,importe:o}=t;return e[n]=(e[n]||0)+o,e},{});const w=Object.keys(S),E=Object.values(S);s.forEach(e=>{const t={label:e.nombre,data:e.importes,borderWidth:2,borderRadius:5,borderSkipped:!1};u.push(t),h.push(e.nombre);const n={label:e.nombre,data:e.importesMeses};f.push(n)}),d.forEach(e=>{const t={label:e.concepto,data:e.importes,borderWidth:2,borderRadius:5,borderSkipped:!1};p.push(t);const n={label:e.concepto,data:e.importesMeses};g.push(n)}),r.forEach(e=>{b.push(e.mes)});const L=document.getElementById("grafica-totales-categoria");new Chart(L,{type:"doughnut",data:{labels:y,datasets:[{label:"cantidad gastada",data:_,borderWidth:2,borderRadius:5,borderSkipped:!1}]},options:{animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Totales por categoría",font:{size:20}}}}});const q=document.getElementById("grafica-totales-miembros");new Chart(q,{type:"doughnut",data:{labels:w,datasets:[{label:"cantidad gastada",data:E,borderWidth:2,borderRadius:5,borderSkipped:!1}]},options:{animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Totales por miembro",font:{size:20}}}}});const x=document.getElementById("grafica-desglose-miembro");new Chart(x,{type:"bar",data:{labels:m,datasets:u},options:{scales:{y:{beginAtZero:!0}},animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Desglose por miembro",font:{size:20}}}}});const C=document.getElementById("grafica-desglose-categoria");new Chart(C,{type:"bar",data:{labels:h,datasets:p},options:{scales:{y:{beginAtZero:!0}},animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Desglose por categoría",font:{size:20}}}}});const k=document.getElementById("grafica-serie-mensual-miembros");new Chart(k,{type:"line",data:{labels:b,datasets:f},options:{scales:{y:{beginAtZero:!0},x:{ticks:{align:"start"}}},animations:{radius:{duration:400,easing:"linear",loop:e=>e.active}},hoverRadius:12,hoverBackgroundColor:"yellow",interaction:{mode:"nearest",intersect:!1,axis:"x"},responsive:!0,elements:{line:{tension:.4}},plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Serie mensual gastos de miembros",font:{size:20}}}}});const $=document.getElementById("grafica-serie-mensual-categorias");new Chart($,{type:"line",data:{labels:b,datasets:g},options:{scales:{y:{beginAtZero:!0},x:{ticks:{align:"start"}}},animations:{radius:{duration:400,easing:"linear",loop:e=>e.active}},hoverRadius:12,hoverBackgroundColor:"yellow",interaction:{mode:"nearest",intersect:!1,axis:"x"},responsive:!0,elements:{line:{tension:.4}},plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Serie mensual gastos por categorías",font:{size:20}}}}});const T=document.createElement("DIV");T.classList.add("filtros-inputs");const N=document.createElement("H2");N.textContent="Filtros: ",T.appendChild(N);const I=document.createElement("DIV");I.classList.add("campo");const j=document.createElement("LABEL");j.textContent="Miembro: ",I.appendChild(j);const D=document.createElement("SELECT");D.id="detalle_de",D.classList.add("miembro__select"),D.innerHTML=`                     \n                <select>\n                    <option value="T" 'selected'> Todos </option>\n                    ${s.map(e=>`\n                        <option value="${e.miembro_id}">${e.nombre}</option>\n                        `).join("")}\n                </select>  \n            `,D.addEventListener("change",(function(e){A()})),I.appendChild(D),T.appendChild(I);const P=document.createElement("DIV");P.classList.add("campo");const z=document.createElement("LABEL");z.textContent="Categoría: ",P.appendChild(z);const F=document.createElement("SELECT");F.id="detalle_concepto",F.classList.add("concepto__select"),F.innerHTML=`   \n                <select>\n                    <option value="T" 'selected'> Todas </option>\n                    ${d.map(e=>`\n                        <option value="${e.concepto}">${e.concepto}</option>\n                        `).join("")}\n                </select>                      \n            `,F.addEventListener("change",(function(e){A()})),P.appendChild(F),T.appendChild(P);const M=document.createElement("DIV");M.classList.add("campo");const O=document.createElement("LABEL");O.textContent="Mes: ",M.appendChild(O);const B=document.createElement("SELECT");function A(){!function(){const e=document.querySelector("#listado-detalle");for(;e.firstChild;)e.removeChild(e.firstChild)}(),function(){const e=document.querySelector("#detalle_de");var t=e.selectedIndex,o=e.options[t];n="T"==o.value?l:l.filter(e=>e.miembro==o.value);const a=document.querySelector("#detalle_concepto");var i=a.selectedIndex,c=a.options[i];"T"!==c.value&&(n=n.filter(e=>e.concepto==c.value));const s=document.querySelector("#detalle_mes");var d=s.selectedIndex,r=s.options[d];"T"!==r.value&&(n=n.filter(e=>e.mes==r.value))}();const e=document.querySelector("#listado-detalle");if(0==n.length){const t=document.createElement("P");t.textContent="No hay movimientos con estos filtros",t.classList.add("no-txs"),e.appendChild(t)}else{const t=document.createElement("TABLE");t.classList.add("table"),t.innerHTML=`\n                        <thead class="table__thead">\n                            <tr>\n                                <th scope="col" class="table__th">Nombre</th>\n                                <th scope="col" class="table__th">Concepto</th>\n                                <th scope="col" class="table__th">Mes</th>\n                                <th scope="col" class="table__th">Importe</th>\n                            </tr>\n                        </thead>\n    \n                        <tbody class="table__tbody">\n                            ${n.map(e=>`\n                                <tr class="table__tr">\n                                    <td class="table__td">\n                                        ${e.nombre}\n                                    </td>\n                                    <td class="table__td">\n                                        ${e.concepto}\n                                    </td>\n                                    <td class="table__td">\n                                        ${e.mes}\n                                    </td>\n                                    <td class="table__td">\n                                        ${parseFloat(parseFloat(e.importe).toFixed(2)).toString()}\n                                    </td>\n                                </tr>\n                            `).join("")}\n                        </tbody>\n                    `,e.appendChild(t)}}B.id="detalle_mes",B.classList.add("mes__select"),B.innerHTML=`   \n                <select>\n                    <option value="T" 'selected'> Todos </option>\n                    ${r.map(e=>`\n                        <option value="${e.mes}">${e.mes}</option>\n                        `).join("")}\n                </select>                      \n            `,B.addEventListener("change",(function(e){A()})),M.appendChild(B),T.appendChild(M),document.querySelector("#filtros-detalle").appendChild(T),A()}()}()},592:()=>{!function(){const e=document.querySelectorAll(".circle"),t=document.querySelector(".color-seleccionado");e&&e.forEach(e=>{e.addEventListener("click",(function(n){const o=document.querySelector(".color-marcado");o&&o.classList.remove("color-marcado"),t.value=n.target.id,e.classList.add("color-marcado")}))})}()},109:()=>{!function(){const e=document.querySelector("#pass");e&&e.addEventListener("input",()=>{e.type="text",setTimeout(()=>{e.type="password"},500)})}()},999:()=>{!function(){const e=document.querySelector("#mobile-menu"),t=document.querySelector("#cerrar-menu"),n=document.querySelector(".sidebar");e&&e.addEventListener("click",(function(){n.classList.toggle("mostrar")})),t&&t.addEventListener("click",(function(){n.classList.add("ocultar"),setTimeout(()=>{n.classList.remove("mostrar"),n.classList.remove("ocultar")},1e3)})),window.addEventListener("resize",(function(){document.body.clientWidth>=768&&n.classList.remove("mostrar")}))}()},155:()=>{!function(){const e=document.querySelectorAll(".table__accion--editar"),t=document.querySelectorAll(".table__accion--boton"),n=document.querySelectorAll(".usuario-id"),o=document.querySelector(".usuario-conectado"),a=document.querySelector(".propietario-grupo"),i=document.querySelector(".grupo-conectado"),c=document.querySelectorAll(".check-usuario"),s=document.querySelectorAll(".check-activo"),d=document.querySelectorAll(".peso-miembro"),r=document.querySelector(".soy-yo");if(e)for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){var n;d[t].classList.contains("no-editable")?swal.fire("El peso no se puede modificar porque ya hay movimientos","","error"):0!=(n=Number(d[t].textContent.replace(",",".")),!!/^\d*([.,]?\d+)?$/.test(n))?l({id:e.target.value,peso:Number(d[t].textContent.replace(",",".")).toFixed(1)}):swal.fire("El peso debe ser numérico","","error")}));if(t)for(let e=0;e<t.length;e++)t[e].addEventListener("click",(function(t){t.target.classList.contains("table__accion--eliminar")?n[e].value==a.value?swal.fire("El propietario no se puede eliminar","","error"):m(t.target.value):t.target.classList.contains("table__accion--inactivar")&&(1==s[e].checked?u({id:this.value,activo:0}):u({id:this.value,activo:1}))}));async function l(e){const{id:t,peso:n}=e,o=new FormData;o.append("id",t),o.append("peso",n);try{const e="/api/miembro/actualizarPeso",t=await fetch(e,{method:"POST",body:o}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}async function m(e){const t=new FormData;t.append("id",e),t.append("url",i.value);try{const e="/api/miembro/eliminar",n=await fetch(e,{method:"POST",body:t}),o=await n.json();swal.fire(o.mensaje,"","exito"==o.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}async function u(e){const{id:t,activo:n}=e,o=new FormData;o.append("id",t),o.append("activo",n);try{const e="/api/miembro/actualizarActivo",t=await fetch(e,{method:"POST",body:o}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}r?c&&c.forEach(e=>e.disabled=!0):c&&c.forEach(e=>{e.addEventListener("change",(function(e){if(this.checked){const e=document.querySelector(".soy-yo");e&&(e.classList.remove("soy-yo"),e.checked=!1),Swal.fire({title:"¿De verdad eres este miembro?",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Que sí",denyButtonText:"No, me equivoqué"}).then(e=>{e.isConfirmed?(this.classList.add("soy-yo"),async function(e){const{id:t,soy_yo:n,usuario_id:o}=e,a=new FormData;a.append("id",t),a.append("soy_yo",n),a.append("usuario_id",o);try{const e="/api/miembro/actualizarSoyYo",t=await fetch(e,{method:"POST",body:a}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}({id:this.value,soy_yo:this.checked,usuario_id:o.value})):e.isDenied&&(this.classList.remove("soy-yo"),this.checked=!1)})}else this.classList.remove("soy-yo")}))})}()}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(()=>{"use strict";function e(e){const t=e.toString().split(".");return 1===t.length||"0"===t[1]?0:t[1].replace(/0+$/,"").length}function t(e,t){return parseFloat(parseFloat(e).toFixed(t)).toString()}function o(e){return""!=e&&!!/^\d*([.,]?\d+)?$/.test(e)}function a(e){var t=e.split(/[\/,: ]/),n=t[0],o=t[1],a=t[2],i=t[4],c=t[5],s=new Date(a,o-1,n,i,c);return a=s.getFullYear(),(o=s.getMonth()+1)<10&&(o="0"+o),(n=s.getDate())<10&&(n="0"+n),(i=s.getHours())<10&&(i="0"+i),(c=s.getMinutes())<10&&(c="0"+c),a+"-"+o+"-"+n+" "+i+":"+c}function i(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const a=document.createElement("DIV");a.classList.add("alerta",t),a.textContent=e,n.parentElement.insertBefore(a,n.nextElementSibling),setTimeout(()=>{a.remove()},1500)}async function c(e){try{const t="/api/miembros-activos?url="+e,n=await fetch(t);return(await n.json()).miembros}catch(e){console.log(e)}}async function s(){try{const e="/api/conceptos",t=await fetch(e);return(await t.json()).conceptos}catch(e){console.log(e)}}async function d(){try{const e="/api/tipos",t=await fetch(e);return(await t.json()).tipos}catch(e){console.log(e)}}async function r(e){try{const t="/api/grupo/getGrupo?url="+e,n=await fetch(t);return(await n.json()).grupo}catch(e){console.log(e)}}async function l(e){try{const t="/api/saldos?url="+e,n=await fetch(t);return(await n.json()).saldos}catch(e){console.log(e)}}function m(e,t,n,o,a){console.log("Hay saldo: ",e),console.log("Mayor saldo"),console.log("Id: ",n),console.log("Saldo: ",t),console.log("Menor saldo"),console.log("Id: ",a),console.log("Saldo: ",o)}n(109),n(592),n(999),function(){const n=document.querySelector(".usuario-conectado"),u=document.querySelector(".nombre-usuario"),p=(document.querySelector(".propietario-grupo"),document.querySelector(".grupo-conectado"));let h,b,f,g=[],v=[],y=[],_=[],S=[],w=[],E=[],L=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),q=0,x=[],C=0,k=0,$=0,T=0,N=[];const I=document.querySelector("#agregar-tx");if(I){!async function(){const e=await Promise.all([c(p.value),s(),d(),r(p.value),l(p.value)]);g=await e[0],v=await e[1],y=await e[2],h=await e[3],_=await e[4],async function(){try{const e="/api/movimientos?url="+p.value,t=await fetch(e),n=await t.json();S=n.movimientos,B()}catch(e){console.log(e)}}(),I.addEventListener("click",(function(){j(!1)}));const t=document.querySelectorAll("#mvtos_de");t&&t.forEach(e=>{e.addEventListener("change",(function(e){!function(e){w="T"!==e?S.filter(t=>t.miembro_id==e):S,B(e)}(e.target.value)}))})}()}function j(c=!1,s={}){if(c){L=new Date(s.fecha).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1});let n=e(s.cantidad);q=t(s.cantidad,n)}else L=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),q=0;const d=document.createElement("DIV");d.classList.add("modal");const r=document.createElement("FORM");r.classList.add("formulario"),r.classList.add("nueva-tx"),r.innerHTML=`\n                <legend>${c?"Editar transacción":"Añade una nueva transacción"}</legend>\n                <div class="campo">\n                    <label>Quién?</label>                        \n                    <select \n                        name="miembro_id" \n                        id="miembro_id"\n                        class="miembro__select"\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${g.map(e=>`\n                        <option ${c&&e.nombre==s.miembro.nombre?"selected":c||e.nombre!=u.value?"":"selected"}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>realiza un </label>                        \n                    <select \n                        name="tipo_id" \n                        id="tipo_id"\n                        class="tipo__select"\n                    >\n                    ${y.map(e=>`\n                        <option ${c&&e.nombre==s.tipo_nombre?"selected":c||"Gasto"!=e.nombre?"":"selected"}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Importe: </label>\n                    <input \n                        type="number" \n                        name="cantidad" \n                        id="cantidad"\n                        value="${c?q:""}"\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Concepto: </label>\n                    <input \n                        type="text" \n                        name="descripcion" \n                        id="descripcion"\n                        value="${c?s.descripcion:""}"\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Para quién?</label>   \n\n                    <div class="cajas-para">\n                    \n                        ${g.map(e=>`\n                            <div class="miembro-para">\n                                <input \n                                    type="checkbox" \n                                    class="for-whom ${c?c&&s.paraquien.includes(e.id)?"check":"":"check"}"\n                                    name="" \n                                    value="${e.id}"\n                                >\n                                ${e.nombre}\n                            </div> \n                            `).join("")}\n                \n                    </div>    \n                </div>\n\n                <div class="campo">\n                    <label>Categoría:</label>                        \n                    <select \n                        name="concepto_id" \n                        id="concepto_id"\n                        class="concepto__select"\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${v.map(e=>`\n                        <option ${c&&e.id==s.concepto_id?"selected":""} \n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Fecha: </label>\n                    <div class="flatpickr">\n                        <input \n                            class="datePicker"\n                            id="datePicker"\n                            name="datePicker"\n                            type="text" \n                            value="${L}"\n                            placeholder="Selecciona una fecha"\n                            data-input \n                        >\n                        <a class="input-button" title="toggle" data-toggle>\n                            <i class="icon-calendar fa-solid fa-calendar"></i>\n                        </a>\n\n                        <a class="input-button" title="clear" data-clear>\n                            <i class="icon-close fa-solid fa-rectangle-xmark"></i>\n                        </a>  \n                    </div>\n                    \n                </div>\n\n                <div class="campo">\n                    <input \n                        type="hidden" \n                        name="id" \n                        id="id"\n                        value="${c?s.id:""}"\n                    >\n                </div>\n\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nueva-tx" \n                        value="${s.id?"Guardar cambios":"Añadir Transacción"}" \n                    >\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        `,setTimeout(()=>{r.classList.add("animar")},0),d.appendChild(r),d.addEventListener("click",(function(e){if(e.preventDefault(),e.target.classList.contains("cerrar-modal")&&(r.classList.add("cerrar"),setTimeout(()=>{d.remove()},500)),e.target.classList.contains("for-whom")&&(e.target.classList.contains("check")?(e.target.classList.remove("check"),e.target.classList.add("nocheck")):(e.target.classList.remove("nocheck"),e.target.classList.add("check"))),e.target.classList.contains("datePicker")){const e=document.querySelector(".flatpickr");flatpickr(e,{enableTime:!0,dateFormat:"Y-m-d H:i",wrap:!0,allowInput:!0,altInput:!0,altFormat:"Y-m-d H:i",defaultDate:"today",time_24hr:!0,onChange:function(e,t,n){b=t}}).toggle()}if(e.target.classList.contains("submit-nueva-tx")){E=[];const e=document.querySelectorAll(".for-whom");e&&e.forEach(e=>{e.classList.contains("check")&&(E=[...E,e.value])});const d=document.querySelector("#cantidad").value,r=Number(d.replace(",",".")),f=document.getElementById("miembro_id");var t=f.selectedIndex,s=f.options[t];const g=document.getElementById("tipo_id");var l=g.selectedIndex,m=g.options[l];const v=document.getElementById("concepto_id");var u=v.selectedIndex,p=v.options[u];const y=document.querySelector("#descripcion").value;b&&""!=b||(b=a(L));let w={};w=c?{id:document.querySelector("#id").value,grupo_id:h.id,miembro_id:s.value,cantidad:r,tipo:m.value,quien:E.toString(),concepto_id:p.value,descripcion:y,fecha:b,actualizador_id:n.value}:{id:document.querySelector("#id").value,grupo_id:h.id,miembro_id:s.value,cantidad:r,tipo:m.value,quien:E.toString(),concepto_id:p.value,descripcion:y,fecha:b,creador_id:n.value};(function(e){let t=!0;return 0==E.length&&(swal.fire("¿Para quién es la transacción? al menos debes seleccionar un miembro","","error"),t=!1),0!=o(e.cantidad)&&0!=e.cantidad||(swal.fire("La cantidad debe ser numérica y mayor que cero","","error"),t=!1),3==e.tipo&&E.includes(e.miembro_id)&&(swal.fire("No se puede saldar deuda con uno mismo","","error"),t=!1),3==e.tipo&&E.length>1&&(swal.fire("Para saldar deuda debes seleccionar sólo un destinatario","","error"),t=!1),""==e.descripcion&&(swal.fire("El concepto es obligatorio","","error"),t=!1),t})(w)&&(c?async function(e){const{id:t}=e;let n=JSON.parse(JSON.stringify(function(e){return S.find((function(t){return t.id===e}))}(t)));n.cantidad=-1*n.cantidad,D(n).then(D(e)).then(P()).then(async function(e){(async function(e){const{id:t,grupo_id:n,miembro_id:o,cantidad:a,tipo:i,quien:c,concepto_id:s,descripcion:d,fecha:r,actualizador_id:l}=e,m=new FormData;m.append("id",t),m.append("grupo_id",n),m.append("miembro_id",o),m.append("cantidad",a),m.append("tipo",i),m.append("quien",c),m.append("concepto_id",s),m.append("descripcion",d),m.append("fecha",r),m.append("actualizador_id",l);try{const e="/api/movimiento/actualizar",n=await fetch(e,{method:"POST",body:m}),o=await n.json();"exito"==o.tipo&&(S=S.map(e=>(e.id==t&&(e.miembro_id=o.movimiento.miembro_id,e.cantidad=o.movimiento.cantidad,e.tipo=o.movimiento.tipo,e.quien=o.movimiento.quien,e.concepto_id=o.movimiento.concepto_id,e.descripcion=o.movimiento.descripcion,e.fecha=o.movimiento.fecha,e.actualizador_id=o.movimiento.actualizador_id,e.miembro=o.movimiento.miembro,e.tipo_nombre=o.movimiento.tipo_nombre,e.paraquien=o.movimiento.paraquien,e.fecha_date=o.movimiento.fecha_date,e.fecha_hora=o.movimiento.fecha_hora),e)))}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;F(t).then(()=>{x.forEach(e=>{M(e)}),_.forEach(e=>{O(e)})})})}(e)).then(()=>{i("Movimiento modificado correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),B()},1500)}).catch(()=>{i("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(w):async function(e){D(e).then(P()).then(async function(e){(async function(e){const{grupo_id:t,miembro_id:n,cantidad:o,tipo:a,quien:i,concepto_id:c,descripcion:s,fecha:d,creador_id:r}=e,l=new FormData;l.append("grupo_id",t),l.append("miembro_id",n),l.append("cantidad",o),l.append("tipo",a),l.append("quien",i),l.append("concepto_id",c),l.append("descripcion",s),l.append("fecha",d),l.append("creador_id",r);try{const e="/api/movimiento/crear",t=await fetch(e,{method:"POST",body:l}),n=await t.json();"exito"==n.tipo&&(S=[n.movimiento,...S])}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;F(t).then(()=>{x.forEach(e=>{M(e)}),_.forEach(e=>{O(e)})})})}(e)).then(()=>{i("Movimiento agregado correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),B()},1500)}).catch(()=>{i("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(w))}})),document.querySelector(".dashboard").appendChild(d)}async function D(e,t=!1){const{miembro_id:n,cantidad:o,tipo:a,quien:i}=e,c=i.split(",");let s=o;if(2==a&&(s*=-1),_.forEach(e=>{e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+s,e.saldo=Number(e.saldo)+s)}),1==a||2==a){let e=0;g.forEach(t=>{c.includes(t.id)&&(e+=Number(t.peso))}),_.forEach(t=>{if(c.includes(t.miembro_id)){let n=0;g.forEach(e=>{e.id==t.miembro_id&&(n=Number(e.peso))}),t.gastos=Number(t.gastos)+s*n/e,t.saldo=Number(t.saldo)-s*n/e}})}3==a&&_.forEach(e=>{c.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-s,e.saldo=Number(e.saldo)-s)})}function P(){x=[],N=JSON.parse(JSON.stringify(_));let e,t=A(N),n=0;for(;t&&n<100;)f=Math.abs(C)>Math.abs(k)?Math.abs(k):Math.abs(C),f>1e-6&&0!=T&&0!=$&&(e={miembro_id:T,cantidad:f,tipo:3,quien:$.toString()},N=z(N,e),x.push(e)),n++,t=A(N);return!t||(console.log("Error de programación, saldar deudas ha entrado en un bucle"),m(t,C,$,k,T),!1)}function z(e,t){const{miembro_id:n,cantidad:o,tipo:a,quien:i}=t,c=i.split(",");let s=o;return e=e.map(e=>(e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+s,e.saldo=Number(e.saldo)+s),e)),3==a&&(e=e.map(e=>(c.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-s,e.saldo=Number(e.saldo)-s),e))),e}async function F(e){const t=new FormData;t.append("grupo_id",e);try{const e="/api/deuda/eliminar",n=await fetch(e,{method:"POST",body:t});await n.json()}catch(e){console.log(e)}}async function M(e){const{miembro_id:t,cantidad:n,quien:o}=e,a=new FormData;a.append("grupo_id",h.id),a.append("from_miembro_id",t),a.append("to_miembro_id",o),a.append("importe",n);try{const e="/api/deuda/crear",t=await fetch(e,{method:"POST",body:a});await t.json()}catch(e){console.log(e)}}async function O(e){const{id:t,grupo_id:n,miembro_id:o,gastos:a,ingresos:i,saldo:c}=e,s=new FormData;s.append("id",t),s.append("grupo_id",h.id),s.append("miembro_id",o),s.append("gastos",a),s.append("ingresos",i),s.append("saldo",c);try{const e="/api/saldo/actualizar",t=await fetch(e,{method:"POST",body:s});await t.json()}catch(e){console.log(e)}}function B(e=""){!function(){const e=document.querySelector("#listado-txs");for(;e.firstChild;)e.removeChild(e.firstChild)}(),""==e&&function(){const e=document.getElementById("mvtos_de");var t=e.selectedIndex,n=e.options[t];w="T"==n.value?S:S.filter(e=>e.miembro_id==n.value)}();const n=document.querySelector("#listado-txs");if(0==w.length){const e=document.createElement("LI");e.textContent="No hay movimientos",e.classList.add("no-txs"),n.appendChild(e)}else w.forEach(e=>{const o=document.createElement("LI");o.dataset.movtoId=e.id,o.classList.add("tx");const a=document.createElement("P");let i=t(e.cantidad,2);a.textContent=`\n                    ${e.miembro.nombre} \n                    realizó un ${e.tipo_nombre} \n                    de ${i} \n                    por ${e.descripcion}\n                    el dia ${e.fecha_date}\n                    a las ${e.fecha_hora}\n                `;const c=document.createElement("DIV");c.classList.add("opciones-mvtos");const s=document.createElement("BUTTON");s.classList.add("editar-mvto"),s.dataset.movtoId=e.id,s.textContent="Editar",s.onclick=function(){j(!0,{...e})};const d=document.createElement("BUTTON");d.classList.add("eliminar-mvto"),d.dataset.movtoId=e.id,d.textContent="Eliminar",d.onclick=function(){!function(e){Swal.fire({title:"¿Eliminar movimiento?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(t=>{t.isConfirmed?async function(e){e.cantidad=-1*e.cantidad,D(e).then(P()).then(async function(e){(async function(e,t=!0){const{id:n}=e,o=new FormData;o.append("id",n);try{const e="/api/movimiento/eliminar",a=await fetch(e,{method:"POST",body:o}),i=await a.json();t&&Swal.fire("Eliminado",i.mensaje,"success"),"exito"==i.tipo&&(S=S.filter(e=>e.id!==n),B())}catch(e){console.log(e)}})(e,!1).then(()=>{const{grupo_id:t}=e;F(t).then(()=>{x.forEach(e=>{M(e)}),_.forEach(e=>{O(e)})})})}(e)).then(()=>{Swal.fire("Movimiento eliminado correctamente"),B()}).catch(()=>{Swal.fire("Error","Ha habido un error en la actualización de tablas")})}(e):Swal.fire("No se ha eliminado el movimiento","","info")})}({...e})},c.appendChild(s),c.appendChild(d),o.appendChild(a),o.appendChild(c),n.appendChild(o)})}function A(e){let t=!1;return C=0,k=0,$=0,T=0,e.forEach(e=>{0!=Number(e.saldo)&&Math.abs(Number(e.saldo))>1e-6&&(t=!0,Number(e.saldo)>C&&(C=Number(e.saldo),$=e.miembro_id),Number(e.saldo)<k&&(k=Number(e.saldo),T=e.miembro_id))}),t}}(),function(){const n=document.querySelector(".usuario-conectado"),u=(document.querySelector(".nombre-usuario"),document.querySelector(".propietario-grupo"),document.querySelector(".grupo-conectado"));let p,h,b,f=[],g=[],v=[],y=[],_=[],S=[],w=[],E=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),L=0,q=[],x=0,C=0,k=0,$=0,T=[];if(document.querySelectorAll("#saldar-deuda")){!async function(){const e=await Promise.all([c(u.value),s(),d(),r(u.value),l(u.value)]);f=await e[0],g=await e[1],v=await e[2],p=await e[3],y=await e[4],I()}()}function N(e,t){const{miembro_id:n,cantidad:o,tipo:a,quien:i}=t,c=i.split(",");let s=o;return e=e.map(e=>(e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+s,e.saldo=Number(e.saldo)+s),e)),3==a&&(e=e.map(e=>(c.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-s,e.saldo=Number(e.saldo)-s),e))),e}async function I(){try{const c="/api/deudas?url="+u.value,s=await fetch(c),d=await s.json();S=d.deudas,function(){!function(){const e=document.querySelector("#listado-deudas");for(;e.firstChild;)e.removeChild(e.firstChild)}();const c=document.querySelector("#listado-deudas");if(0==S.length){const e=document.createElement("LI");e.textContent="No hay deudas",e.classList.add("no-deudas","animate__animated","animate__rubberBand"),c.appendChild(e)}else S.forEach(s=>{const d=document.createElement("LI");d.classList.add("deuda");const r=document.createElement("P");r.classList.add("animate__animated","animate__lightSpeedInLeft"),r.textContent=s.from_miembro.nombre,d.appendChild(r);const l=document.createElement("DIV");l.classList.add("flecha","saldar-deuda","animate__animated","animate__bounce"),l.id="saldar-deuda";const u=document.createElement("SPAN"),g=t(s.importe,2);u.textContent=`debe ${g} € a`,l.appendChild(u),l.onclick=function(){!function(c={}){E=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1});let s=e(c.importe);L=t(c.importe,s);const d=document.createElement("DIV");d.classList.add("modal");const r=document.createElement("FORM");r.classList.add("formulario"),r.classList.add("nueva-tx"),r.innerHTML=`\n                <legend>Saldar Deuda</legend>\n                <div class="campo">\n                    <label>Quién?</label>                        \n                    <select \n                        name="miembro_id" \n                        id="miembro_id"\n                        class="miembro__select"\n                        disabled\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${f.map(e=>`\n                        <option ${e.id==c.from_miembro_id?"selected":""}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>realiza un </label>                        \n                    <select \n                        name="tipo_id" \n                        id="tipo_id"\n                        class="tipo__select"\n                        disabled\n                    >\n                    ${v.map(e=>`\n                        <option ${"Transferencia"==e.nombre?"selected":""}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Importe: </label>\n                    <input \n                        type="number" \n                        name="cantidad" \n                        id="cantidad"\n                        value="${L}"\n                        readonly\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Concepto: </label>\n                    <input \n                        type="text" \n                        name="descripcion" \n                        id="descripcion"\n                        value="Saldar deuda"\n                        readonly\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Para quién?</label>   \n\n                    <div class="cajas-para">\n                    \n                        ${f.map(e=>`\n                            <div class="miembro-para">\n                                <input \n                                    type="checkbox" \n                                    class="for-whom ${c.to_miembro_id==e.id?"check":""}"\n                                    name="" \n                                    value="${e.id}"\n                                    disabled\n                                >\n                                ${e.nombre}\n                            </div> \n                            `).join("")}\n                \n                    </div>    \n                </div>\n\n                <div class="campo">\n                    <label>Fecha: </label>\n                    <div class="flatpickr">\n                        <input \n                            class="datePicker"\n                            id="datePicker"\n                            name="datePicker"\n                            type="text" \n                            value="${E}"\n                            placeholder="Selecciona una fecha"\n                            data-input \n                        >\n                        <a class="input-button" title="toggle" data-toggle>\n                            <i class="icon-calendar fa-solid fa-calendar"></i>\n                        </a>\n\n                        <a class="input-button" title="clear" data-clear>\n                            <i class="icon-close fa-solid fa-rectangle-xmark"></i>\n                        </a>  \n                    </div>\n                    \n                </div>\n\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nueva-tx" \n                        value="Saldar deuda" \n                    >\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        `,setTimeout(()=>{r.classList.add("animar")},0),d.appendChild(r),d.addEventListener("click",(function(e){if(e.preventDefault(),e.target.classList.contains("cerrar-modal")&&(r.classList.add("cerrar"),setTimeout(()=>{d.remove()},500)),e.target.classList.contains("for-whom")&&(e.target.classList.contains("check")?(e.target.classList.remove("check"),e.target.classList.add("nocheck")):(e.target.classList.remove("nocheck"),e.target.classList.add("check"))),e.target.classList.contains("datePicker")){const e=document.querySelector(".flatpickr");flatpickr(e,{enableTime:!0,dateFormat:"Y-m-d H:i",wrap:!0,allowInput:!0,altInput:!0,altFormat:"Y-m-d H:i",defaultDate:"today",time_24hr:!0,onChange:function(e,t,n){h=t}}).toggle()}if(e.target.classList.contains("submit-nueva-tx")){w=[];const e=document.querySelectorAll(".for-whom");e&&e.forEach(e=>{e.classList.contains("check")&&(w=[...w,e.value])});const d=document.querySelector("#cantidad").value,r=Number(d.replace(",",".")),u=document.getElementById("miembro_id");var t=u.selectedIndex,c=u.options[t];const g=document.getElementById("tipo_id");var s=g.selectedIndex,l=g.options[s];const v=document.querySelector("#descripcion").value;h&&""!=h||(h=a(E));let S={};S={grupo_id:p.id,miembro_id:c.value,cantidad:r,tipo:l.value,quien:w.toString(),concepto_id:"",descripcion:v,fecha:h,creador_id:n.value};(function(e){let t=!0;return 0==w.length&&(swal.fire("¿Para quién es la transacción? al menos debes seleccionar un miembro","","error"),t=!1),0!=o(e.cantidad)&&0!=e.cantidad||(swal.fire("La cantidad debe ser numérica y mayor que cero","","error"),t=!1),3==e.tipo&&w.includes(e.miembro_id)&&(swal.fire("No se puede saldar deuda con uno mismo","","error"),t=!1),3==e.tipo&&w.length>1&&(swal.fire("Para saldar deuda debes seleccionar sólo un destinatario","","error"),t=!1),""==e.descripcion&&(swal.fire("El concepto es obligatorio","","error"),t=!1),t})(S)&&async function(e){(async function(e,t=!1){const{miembro_id:n,cantidad:o,tipo:a,quien:i}=e,c=i.split(",");let s=o;if(2==a&&(s*=-1),y.forEach(e=>{e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+s,e.saldo=Number(e.saldo)+s)}),1==a||2==a){let e=0;f.forEach(t=>{c.includes(t.id)&&(e+=Number(t.peso))}),y.forEach(t=>{if(c.includes(t.miembro_id)){let n=0;f.forEach(e=>{e.id==t.miembro_id&&(n=Number(e.peso))}),t.gastos=Number(t.gastos)+s*n/e,t.saldo=Number(t.saldo)-s*n/e}})}3==a&&y.forEach(e=>{c.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-s,e.saldo=Number(e.saldo)-s)})})(e).then(function(){q=[],T=JSON.parse(JSON.stringify(y));let e,t=j(T),n=0;for(;t&&n<100;)b=Math.abs(x)>Math.abs(C)?Math.abs(C):Math.abs(x),b>1e-6&&0!=$&&0!=k&&(e={miembro_id:$,cantidad:b,tipo:3,quien:k.toString()},T=N(T,e),q.push(e)),n++,t=j(T);return!t||(console.log("Error de programación, saldar deudas ha entrado en un bucle"),m(t,x,k,C,$),!1)}()).then(async function(e){(async function(e){const{grupo_id:t,miembro_id:n,cantidad:o,tipo:a,quien:i,concepto_id:c,descripcion:s,fecha:d,creador_id:r}=e,l=new FormData;l.append("grupo_id",t),l.append("miembro_id",n),l.append("cantidad",o),l.append("tipo",a),l.append("quien",i),l.append("concepto_id",c),l.append("descripcion",s),l.append("fecha",d),l.append("creador_id",r);try{const e="/api/movimiento/crear",t=await fetch(e,{method:"POST",body:l}),n=await t.json();"exito"==n.tipo&&(_=[..._,n.movimiento])}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;(async function(e){const t=new FormData;t.append("grupo_id",e);try{const e="/api/deuda/eliminar",n=await fetch(e,{method:"POST",body:t});await n.json()}catch(e){console.log(e)}})(t).then(()=>{q.forEach(e=>{!async function(e){const{miembro_id:t,cantidad:n,quien:o}=e,a=new FormData;a.append("grupo_id",p.id),a.append("from_miembro_id",t),a.append("to_miembro_id",o),a.append("importe",n);try{const e="/api/deuda/crear",t=await fetch(e,{method:"POST",body:a});await t.json()}catch(e){console.log(e)}}(e)}),y.forEach(e=>{!async function(e){const{id:t,grupo_id:n,miembro_id:o,gastos:a,ingresos:i,saldo:c}=e,s=new FormData;s.append("id",t),s.append("grupo_id",p.id),s.append("miembro_id",o),s.append("gastos",a),s.append("ingresos",i),s.append("saldo",c);try{const e="/api/saldo/actualizar",t=await fetch(e,{method:"POST",body:s});await t.json()}catch(e){console.log(e)}}(e)})})})}(e)).then(()=>{i("Deuda saldada correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),I()},1500)}).catch(()=>{i("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(S)}})),document.querySelector(".dashboard").appendChild(d)}(s)},d.appendChild(l);const S=document.createElement("P");S.classList.add("animate__animated","animate__lightSpeedInRight"),S.textContent=s.to_miembro.nombre,d.appendChild(S),c.appendChild(d)})}()}catch(e){console.log(e)}}function j(e){let t=!1;return x=0,C=0,k=0,$=0,e.forEach(e=>{0!=Number(e.saldo)&&Math.abs(Number(e.saldo))>1e-6&&(t=!0,Number(e.saldo)>x&&(x=Number(e.saldo),k=e.miembro_id),Number(e.saldo)<C&&(C=Number(e.saldo),$=e.miembro_id))}),t}}(),n(155),n(724)})()})();
//# sourceMappingURL=main.js.map

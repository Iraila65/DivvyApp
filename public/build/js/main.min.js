(()=>{var e={724:()=>{!function(){const e=document.querySelector(".grupo-conectado");document.querySelector(".dashboard__grafica")&&async function(){const t="/api/movimientos/gastos?url="+e.value,n=await fetch(t),a=await n.json(),o=Object.values(a),i=o[0],c=o[1],r=o[2],d=Object.keys(i),s=Object.values(i),l=[],u=[],m=[],p=[],h=[];s.forEach(e=>{const t=Object.values(e);let n=0;t.forEach(e=>{n+=e.importe}),l.push(n)}),c.forEach(e=>{const t={label:e.nombre,data:e.importes,borderWidth:2,borderRadius:5,borderSkipped:!1};u.push(t),p.push(e.nombre);let n=e.importes.reduce((function(e,t){return e+t}),0);h.push(n)}),r.forEach(e=>{const t={label:e.concepto,data:e.importes,borderWidth:2,borderRadius:5,borderSkipped:!1};m.push(t)});const b=document.getElementById("grafica-totales-categoria");new Chart(b,{type:"doughnut",data:{labels:d,datasets:[{label:"cantidad gastada",data:l,borderWidth:2,borderRadius:5,borderSkipped:!1}]},options:{scales:{y:{beginAtZero:!0}},animation:!0,responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0},title:{display:!0,text:"Totales por categoría",font:{size:20}}}}});const f=document.getElementById("grafica-totales-miembros");new Chart(f,{type:"doughnut",data:{labels:p,datasets:[{label:"cantidad gastada",data:h,borderWidth:2,borderRadius:5,borderSkipped:!1}]},options:{scales:{y:{beginAtZero:!0}},animation:!0,responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0},title:{display:!0,text:"Totales por miembro",font:{size:20}}}}});const g=document.getElementById("grafica-desglose-miembro");new Chart(g,{type:"bar",data:{labels:d,datasets:u},options:{scales:{y:{beginAtZero:!0}},animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Desglose por miembro",font:{size:20}}}}});const y=document.getElementById("grafica-desglose-categoria");new Chart(y,{type:"bar",data:{labels:p,datasets:m},options:{scales:{y:{beginAtZero:!0}},animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Desglose por categoría",font:{size:20}}}}})}()}()},592:()=>{!function(){const e=document.querySelectorAll(".circle"),t=document.querySelector(".color-seleccionado");e&&e.forEach(e=>{e.addEventListener("click",(function(n){const a=document.querySelector(".color-marcado");a&&a.classList.remove("color-marcado"),t.value=n.target.id,e.classList.add("color-marcado")}))})}()},354:()=>{!function(){const e=document.querySelector(".usuario-conectado"),t=(document.querySelector(".nombre-usuario"),document.querySelector(".propietario-grupo"),document.querySelector(".grupo-conectado"));let n,a,o,i=[],c=[],r=[],d=[],s=[],l=[],u=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),m=0,p=[],h=0,b=0,f=0,g=0,y=[];async function v(){try{const e="/api/miembros-activos?url="+t.value,n=await fetch(e);return(await n.json()).miembros}catch(e){console.log(e)}}async function _(){try{const e="/api/conceptos",t=await fetch(e);return(await t.json()).conceptos}catch(e){console.log(e)}}async function w(){try{const e="/api/tipos",t=await fetch(e);return(await t.json()).tipos}catch(e){console.log(e)}}async function S(e){try{const t="/api/grupo/getGrupo?url="+e,n=await fetch(t);return(await n.json()).grupo}catch(e){console.log(e)}}async function E(){try{const e="/api/saldos?url="+t.value,n=await fetch(e);return(await n.json()).saldos}catch(e){console.log(e)}}function q(e,t,n){const a=document.querySelector(".alerta");a&&a.remove();const o=document.createElement("DIV");o.classList.add("alerta",t),o.textContent=e,n.parentElement.insertBefore(o,n.nextElementSibling),setTimeout(()=>{o.remove()},1500)}function L(e,t){const{miembro_id:n,cantidad:a,tipo:o,quien:i}=t,c=i.split(",");let r=a;return e=e.map(e=>(e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+r,e.saldo=Number(e.saldo)+r),e)),3==o&&(e=e.map(e=>(c.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-r,e.saldo=Number(e.saldo)-r),e))),e}async function x(){try{const v="/api/deudas?url="+t.value,_=await fetch(v),w=await _.json();s=w.deudas,function(){!function(){const e=document.querySelector("#listado-deudas");for(;e.firstChild;)e.removeChild(e.firstChild)}();const t=document.querySelector("#listado-deudas");if(0==s.length){const e=document.createElement("LI");e.textContent="No hay deudas",e.classList.add("no-deudas","animate__animated","animate__rubberBand"),t.appendChild(e)}else s.forEach(s=>{const v=document.createElement("LI");v.classList.add("deuda");const _=document.createElement("P");_.classList.add("animate__animated","animate__lightSpeedInLeft"),_.textContent=s.from_miembro.nombre,v.appendChild(_);const w=document.createElement("DIV");w.classList.add("flecha","saldar-deuda","animate__animated","animate__bounce"),w.id="saldar-deuda";const S=document.createElement("SPAN"),E=N(s.importe,2);S.textContent=`debe ${E} € a`,w.appendChild(S),w.onclick=function(){!function(t={}){u=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1});let s=function(e){const t=e.toString().split(".");return 1===t.length||"0"===t[1]?0:t[1].replace(/0+$/,"").length}(t.importe);m=N(t.importe,s);const v=document.createElement("DIV");v.classList.add("modal");const _=document.createElement("FORM");_.classList.add("formulario"),_.classList.add("nueva-tx"),_.innerHTML=`\n                <legend>Saldar Deuda</legend>\n                <div class="campo">\n                    <label>Quién?</label>                        \n                    <select \n                        name="miembro_id" \n                        id="miembro_id"\n                        class="miembro__select"\n                        disabled\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${i.map(e=>`\n                        <option ${e.id==t.from_miembro_id?"selected":""}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>realiza un </label>                        \n                    <select \n                        name="tipo_id" \n                        id="tipo_id"\n                        class="tipo__select"\n                        disabled\n                    >\n                    ${c.map(e=>`\n                        <option ${"Transferencia"==e.nombre?"selected":""}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Importe: </label>\n                    <input \n                        type="number" \n                        name="cantidad" \n                        id="cantidad"\n                        value="${m}"\n                        readonly\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Concepto: </label>\n                    <input \n                        type="text" \n                        name="descripcion" \n                        id="descripcion"\n                        value="Saldar deuda"\n                        readonly\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Para quién?</label>   \n\n                    <div class="cajas-para">\n                    \n                        ${i.map(e=>`\n                            <div class="miembro-para">\n                                <input \n                                    type="checkbox" \n                                    class="for-whom ${t.to_miembro_id==e.id?"check":""}"\n                                    name="" \n                                    value="${e.id}"\n                                    disabled\n                                >\n                                ${e.nombre}\n                            </div> \n                            `).join("")}\n                \n                    </div>    \n                </div>\n\n                <div class="campo">\n                    <label>Fecha: </label>\n                    <div class="flatpickr">\n                        <input \n                            class="datePicker"\n                            id="datePicker"\n                            name="datePicker"\n                            type="text" \n                            value="${u}"\n                            placeholder="Selecciona una fecha"\n                            data-input \n                        >\n                        <a class="input-button" title="toggle" data-toggle>\n                            <i class="icon-calendar fa-solid fa-calendar"></i>\n                        </a>\n\n                        <a class="input-button" title="clear" data-clear>\n                            <i class="icon-close fa-solid fa-rectangle-xmark"></i>\n                        </a>  \n                    </div>\n                    \n                </div>\n\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nueva-tx" \n                        value="Saldar deuda" \n                    >\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        `,setTimeout(()=>{_.classList.add("animar")},0),v.appendChild(_),v.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("cerrar-modal")&&(_.classList.add("cerrar"),setTimeout(()=>{v.remove()},500)),t.target.classList.contains("for-whom")&&(t.target.classList.contains("check")?(t.target.classList.remove("check"),t.target.classList.add("nocheck")):(t.target.classList.remove("nocheck"),t.target.classList.add("check"))),t.target.classList.contains("datePicker")){const e=document.querySelector(".flatpickr");flatpickr(e,{enableTime:!0,dateFormat:"Y-m-d H:i",wrap:!0,allowInput:!0,altInput:!0,altFormat:"Y-m-d H:i",defaultDate:"today",time_24hr:!0,onChange:function(e,t,n){a=t}}).toggle()}if(t.target.classList.contains("submit-nueva-tx")){l=[];const t=document.querySelectorAll(".for-whom");t&&t.forEach(e=>{e.classList.contains("check")&&(l=[...l,e.value])});const v=document.querySelector("#cantidad").value,_=Number(v.replace(",",".")),D=document.getElementById("miembro_id");var c=D.selectedIndex,s=D.options[c];const I=document.getElementById("tipo_id");var m=I.selectedIndex,w=I.options[m];const P=document.querySelector("#descripcion").value;a&&""!=a||(E=(S=u.split(/[\/,: ]/))[0],N=S[1],C=S[2],$=S[4],j=S[5],C=(T=new Date(C,N-1,E,$,j)).getFullYear(),(N=T.getMonth()+1)<10&&(N="0"+N),(E=T.getDate())<10&&(E="0"+E),($=T.getHours())<10&&($="0"+$),(j=T.getMinutes())<10&&(j="0"+j),a=C+"-"+N+"-"+E+" "+$+":"+j);let F={};F={grupo_id:n.id,miembro_id:s.value,cantidad:_,tipo:w.value,quien:l.toString(),concepto_id:"",descripcion:P,fecha:a,creador_id:e.value};(function(e){let t=!0;var n;return 0==l.length&&(swal.fire("¿Para quién es la transacción? al menos debes seleccionar un miembro","","error"),t=!1),0!=(""!=(n=e.cantidad)&&!!/^\d*([.,]?\d+)?$/.test(n))&&0!=e.cantidad||(swal.fire("La cantidad debe ser numérica y mayor que cero","","error"),t=!1),3==e.tipo&&l.includes(e.miembro_id)&&(swal.fire("No se puede saldar deuda con uno mismo","","error"),t=!1),3==e.tipo&&l.length>1&&(swal.fire("Para saldar deuda debes seleccionar sólo un destinatario","","error"),t=!1),""==e.descripcion&&(swal.fire("El concepto es obligatorio","","error"),t=!1),t})(F)&&async function(e){(async function(e,t=!1){const{miembro_id:n,cantidad:a,tipo:o,quien:c}=e,d=c.split(",");let s=a;if(2==o&&(s*=-1),r.forEach(e=>{e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+s,e.saldo=Number(e.saldo)+s)}),1==o||2==o){let e=0;i.forEach(t=>{d.includes(t.id)&&(e+=Number(t.peso))}),r.forEach(t=>{if(d.includes(t.miembro_id)){let n=0;i.forEach(e=>{e.id==t.miembro_id&&(n=Number(e.peso))}),t.gastos=Number(t.gastos)+s*n/e,t.saldo=Number(t.saldo)-s*n/e}})}3==o&&r.forEach(e=>{d.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-s,e.saldo=Number(e.saldo)-s)})})(e).then(function(){p=[],h=0,b=0,f=0,g=0,y=JSON.parse(JSON.stringify(r));let e,t=k(y),n=0;for(;t&&n<100;)o=Math.abs(h)>Math.abs(b)?Math.abs(b):Math.abs(h),o>1e-6&&0!=g&&0!=f&&(e={miembro_id:g,cantidad:o,tipo:3,quien:f.toString()},y=L(y,e),p.push(e)),n++,h=0,b=0,f=0,g=0,t=k(y);return!t||(console.log("Error de programación, saldar deudas ha entrado en un bucle"),!1)}()).then(async function(e){(async function(e){const{grupo_id:t,miembro_id:n,cantidad:a,tipo:o,quien:i,concepto_id:c,descripcion:r,fecha:s,creador_id:l}=e,u=new FormData;u.append("grupo_id",t),u.append("miembro_id",n),u.append("cantidad",a),u.append("tipo",o),u.append("quien",i),u.append("concepto_id",c),u.append("descripcion",r),u.append("fecha",s),u.append("creador_id",l);try{const e="/api/movimiento/crear",t=await fetch(e,{method:"POST",body:u}),n=await t.json();"exito"==n.tipo&&(d=[...d,n.movimiento])}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;(async function(e){const t=new FormData;t.append("grupo_id",e);try{const e="/api/deuda/eliminar",n=await fetch(e,{method:"POST",body:t});await n.json()}catch(e){console.log(e)}})(t).then(()=>{p.forEach(e=>{!async function(e){const{miembro_id:t,cantidad:a,quien:o}=e,i=new FormData;i.append("grupo_id",n.id),i.append("from_miembro_id",t),i.append("to_miembro_id",o),i.append("importe",a);try{const e="/api/deuda/crear",t=await fetch(e,{method:"POST",body:i});await t.json()}catch(e){console.log(e)}}(e)}),r.forEach(e=>{!async function(e){const{id:t,grupo_id:a,miembro_id:o,gastos:i,ingresos:c,saldo:r}=e,d=new FormData;d.append("id",t),d.append("grupo_id",n.id),d.append("miembro_id",o),d.append("gastos",i),d.append("ingresos",c),d.append("saldo",r);try{const e="/api/saldo/actualizar",t=await fetch(e,{method:"POST",body:d});await t.json()}catch(e){console.log(e)}}(e)})})})}(e)).then(()=>{q("Deuda saldada correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),x()},1500)}).catch(()=>{q("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(F)}var S,E,N,C,$,j,T})),document.querySelector(".dashboard").appendChild(v)}(s)},v.appendChild(w);const C=document.createElement("P");C.classList.add("animate__animated","animate__lightSpeedInRight"),C.textContent=s.to_miembro.nombre,v.appendChild(C),t.appendChild(v)})}()}catch(e){console.log(e)}}function k(e){let t=!1;return e.forEach(e=>{0!=Number(e.saldo)&&(t=!0,Number(e.saldo)>h&&(h=Number(e.saldo),f=e.miembro_id),Number(e.saldo)<b&&(b=Number(e.saldo),g=e.miembro_id))}),t}function N(e,t){return parseFloat(parseFloat(e).toFixed(t)).toString()}document.querySelectorAll("#saldar-deuda")&&async function(){const e=await Promise.all([v(),_(),w(),S(t.value),E()]);i=await e[0],conceptos=await e[1],c=await e[2],n=await e[3],r=await e[4],x()}()}()},999:()=>{!function(){const e=document.querySelector("#mobile-menu"),t=document.querySelector("#cerrar-menu"),n=document.querySelector(".sidebar");e&&e.addEventListener("click",(function(){n.classList.toggle("mostrar")})),t&&t.addEventListener("click",(function(){n.classList.add("ocultar"),setTimeout(()=>{n.classList.remove("mostrar"),n.classList.remove("ocultar")},1e3)})),window.addEventListener("resize",(function(){document.body.clientWidth>=768&&n.classList.remove("mostrar")}))}()},155:()=>{!function(){const e=document.querySelectorAll(".table__accion--editar"),t=document.querySelectorAll(".table__accion--boton"),n=document.querySelectorAll(".usuario-id"),a=document.querySelector(".usuario-conectado"),o=document.querySelector(".propietario-grupo"),i=document.querySelector(".grupo-conectado"),c=document.querySelectorAll(".check-usuario"),r=document.querySelectorAll(".check-activo"),d=document.querySelectorAll(".peso-miembro"),s=document.querySelector(".soy-yo");if(e)for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){var n;0!=(n=Number(d[t].textContent.replace(",",".")),!!/^\d*([.,]?\d+)?$/.test(n))?l({id:e.target.value,peso:Number(d[t].textContent.replace(",",".")).toFixed(1)}):swal.fire("El peso debe ser numérico","","error")}));if(t)for(let e=0;e<t.length;e++)t[e].addEventListener("click",(function(t){t.target.classList.contains("table__accion--eliminar")?n[e].value==o.value?swal.fire("El propietario no se puede eliminar","","error"):u(t.target.value):t.target.classList.contains("table__accion--inactivar")&&(1==r[e].checked?m({id:this.value,activo:0}):m({id:this.value,activo:1}))}));async function l(e){const{id:t,peso:n}=e,a=new FormData;a.append("id",t),a.append("peso",n);try{const e="/api/miembro/actualizarPeso",t=await fetch(e,{method:"POST",body:a}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}async function u(e){const t=new FormData;t.append("id",e),t.append("url",i.value);try{const e="/api/miembro/eliminar",n=await fetch(e,{method:"POST",body:t}),a=await n.json();swal.fire(a.mensaje,"","exito"==a.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}async function m(e){const{id:t,activo:n}=e,a=new FormData;a.append("id",t),a.append("activo",n);try{const e="/api/miembro/actualizarActivo",t=await fetch(e,{method:"POST",body:a}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}s?c&&c.forEach(e=>e.disabled=!0):c&&c.forEach(e=>{e.addEventListener("change",(function(e){if(this.checked){const e=document.querySelector(".soy-yo");e&&(e.classList.remove("soy-yo"),e.checked=!1),Swal.fire({title:"¿De verdad eres este miembro?",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Que sí",denyButtonText:"No, me equivoqué"}).then(e=>{e.isConfirmed?(this.classList.add("soy-yo"),async function(e){const{id:t,soy_yo:n,usuario_id:a}=e,o=new FormData;o.append("id",t),o.append("soy_yo",n),o.append("usuario_id",a);try{const e="/api/miembro/actualizarSoyYo",t=await fetch(e,{method:"POST",body:o}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}({id:this.value,soy_yo:this.checked,usuario_id:a.value})):e.isDenied&&(this.classList.remove("soy-yo"),this.checked=!1)})}else this.classList.remove("soy-yo")}))})}()},235:()=>{!function(){const e=document.querySelector(".usuario-conectado"),t=document.querySelector(".nombre-usuario"),n=(document.querySelector(".propietario-grupo"),document.querySelector(".grupo-conectado"));let a,o,i,c=[],r=[],d=[],s=[],l=[],u=[],m=[],p=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),h=0,b=[],f=0,g=0,y=0,v=0,_=[];const w=document.querySelector("#agregar-tx");async function S(){try{const e="/api/miembros-activos?url="+n.value,t=await fetch(e);return(await t.json()).miembros}catch(e){console.log(e)}}async function E(){try{const e="/api/conceptos",t=await fetch(e);return(await t.json()).conceptos}catch(e){console.log(e)}}async function q(){try{const e="/api/tipos",t=await fetch(e);return(await t.json()).tipos}catch(e){console.log(e)}}async function L(e){try{const t="/api/grupo/getGrupo?url="+e,n=await fetch(t);return(await n.json()).grupo}catch(e){console.log(e)}}async function x(){try{const e="/api/saldos?url="+n.value,t=await fetch(e);return(await t.json()).saldos}catch(e){console.log(e)}}function k(n=!1,i={}){if(n){p=new Date(i.fecha).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1});let e=function(e){const t=e.toString().split(".");return 1===t.length||"0"===t[1]?0:t[1].replace(/0+$/,"").length}(i.cantidad);h=O(i.cantidad,e)}else p=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),h=0;const u=document.createElement("DIV");u.classList.add("modal");const f=document.createElement("FORM");f.classList.add("formulario"),f.classList.add("nueva-tx"),f.innerHTML=`\n                <legend>${n?"Editar transacción":"Añade una nueva transacción"}</legend>\n                <div class="campo">\n                    <label>Quién?</label>                        \n                    <select \n                        name="miembro_id" \n                        id="miembro_id"\n                        class="miembro__select"\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${c.map(e=>`\n                        <option ${n&&e.nombre==i.miembro.nombre?"selected":n||e.nombre!=t.value?"":"selected"}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>realiza un </label>                        \n                    <select \n                        name="tipo_id" \n                        id="tipo_id"\n                        class="tipo__select"\n                    >\n                    ${d.map(e=>`\n                        <option ${n&&e.nombre==i.tipo_nombre?"selected":n||"Gasto"!=e.nombre?"":"selected"}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Importe: </label>\n                    <input \n                        type="number" \n                        name="cantidad" \n                        id="cantidad"\n                        value="${n?h:""}"\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Concepto: </label>\n                    <input \n                        type="text" \n                        name="descripcion" \n                        id="descripcion"\n                        value="${n?i.descripcion:""}"\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Para quién?</label>   \n\n                    <div class="cajas-para">\n                    \n                        ${c.map(e=>`\n                            <div class="miembro-para">\n                                <input \n                                    type="checkbox" \n                                    class="for-whom ${n?n&&i.paraquien.includes(e.id)?"check":"":"check"}"\n                                    name="" \n                                    value="${e.id}"\n                                >\n                                ${e.nombre}\n                            </div> \n                            `).join("")}\n                \n                    </div>    \n                </div>\n\n                <div class="campo">\n                    <label>Categoría:</label>                        \n                    <select \n                        name="concepto_id" \n                        id="concepto_id"\n                        class="concepto__select"\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${r.map(e=>`\n                        <option ${n&&e.id==i.concepto_id?"selected":""} \n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Fecha: </label>\n                    <div class="flatpickr">\n                        <input \n                            class="datePicker"\n                            id="datePicker"\n                            name="datePicker"\n                            type="text" \n                            value="${p}"\n                            placeholder="Selecciona una fecha"\n                            data-input \n                        >\n                        <a class="input-button" title="toggle" data-toggle>\n                            <i class="icon-calendar fa-solid fa-calendar"></i>\n                        </a>\n\n                        <a class="input-button" title="clear" data-clear>\n                            <i class="icon-close fa-solid fa-rectangle-xmark"></i>\n                        </a>  \n                    </div>\n                    \n                </div>\n\n                <div class="campo">\n                    <input \n                        type="hidden" \n                        name="id" \n                        id="id"\n                        value="${n?i.id:""}"\n                    >\n                </div>\n\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nueva-tx" \n                        value="${i.id?"Guardar cambios":"Añadir Transacción"}" \n                    >\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        `,setTimeout(()=>{f.classList.add("animar")},0),u.appendChild(f),u.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("cerrar-modal")&&(f.classList.add("cerrar"),setTimeout(()=>{u.remove()},500)),t.target.classList.contains("for-whom")&&(t.target.classList.contains("check")?(t.target.classList.remove("check"),t.target.classList.add("nocheck")):(t.target.classList.remove("nocheck"),t.target.classList.add("check"))),t.target.classList.contains("datePicker")){const e=document.querySelector(".flatpickr");flatpickr(e,{enableTime:!0,dateFormat:"Y-m-d H:i",wrap:!0,allowInput:!0,altInput:!0,altFormat:"Y-m-d H:i",defaultDate:"today",time_24hr:!0,onChange:function(e,t,n){o=t}}).toggle()}if(t.target.classList.contains("submit-nueva-tx")){m=[];const t=document.querySelectorAll(".for-whom");t&&t.forEach(e=>{e.classList.contains("check")&&(m=[...m,e.value])});const u=document.querySelector("#cantidad").value,f=Number(u.replace(",",".")),L=document.getElementById("miembro_id");var i=L.selectedIndex,c=L.options[i];const x=document.getElementById("tipo_id");var r=x.selectedIndex,d=x.options[r];const k=document.getElementById("concepto_id");var h=k.selectedIndex,g=k.options[h];const j=document.querySelector("#descripcion").value;o&&""!=o||(v=(y=p.split(/[\/,: ]/))[0],_=y[1],w=y[2],S=y[4],E=y[5],w=(q=new Date(w,_-1,v,S,E)).getFullYear(),(_=q.getMonth()+1)<10&&(_="0"+_),(v=q.getDate())<10&&(v="0"+v),(S=q.getHours())<10&&(S="0"+S),(E=q.getMinutes())<10&&(E="0"+E),o=w+"-"+_+"-"+v+" "+S+":"+E);let F={};F=n?{id:document.querySelector("#id").value,grupo_id:a.id,miembro_id:c.value,cantidad:f,tipo:d.value,quien:m.toString(),concepto_id:g.value,descripcion:j,fecha:o,actualizador_id:e.value}:{id:document.querySelector("#id").value,grupo_id:a.id,miembro_id:c.value,cantidad:f,tipo:d.value,quien:m.toString(),concepto_id:g.value,descripcion:j,fecha:o,creador_id:e.value};(function(e){let t=!0;var n;return 0==m.length&&(swal.fire("¿Para quién es la transacción? al menos debes seleccionar un miembro","","error"),t=!1),0!=(""!=(n=e.cantidad)&&!!/^\d*([.,]?\d+)?$/.test(n))&&0!=e.cantidad||(swal.fire("La cantidad debe ser numérica y mayor que cero","","error"),t=!1),3==e.tipo&&m.includes(e.miembro_id)&&(swal.fire("No se puede saldar deuda con uno mismo","","error"),t=!1),3==e.tipo&&m.length>1&&(swal.fire("Para saldar deuda debes seleccionar sólo un destinatario","","error"),t=!1),""==e.descripcion&&(swal.fire("El concepto es obligatorio","","error"),t=!1),t})(F)&&(n?async function(e){const{id:t}=e;let n=JSON.parse(JSON.stringify(function(e){return l.find((function(t){return t.id===e}))}(t)));n.cantidad=-1*n.cantidad,C(n).then(C(e)).then($()).then(async function(e){(async function(e){const{id:t,grupo_id:n,miembro_id:a,cantidad:o,tipo:i,quien:c,concepto_id:r,descripcion:d,fecha:s,actualizador_id:u}=e,m=new FormData;m.append("id",t),m.append("grupo_id",n),m.append("miembro_id",a),m.append("cantidad",o),m.append("tipo",i),m.append("quien",c),m.append("concepto_id",r),m.append("descripcion",d),m.append("fecha",s),m.append("actualizador_id",u);try{const e="/api/movimiento/actualizar",n=await fetch(e,{method:"POST",body:m}),a=await n.json();"exito"==a.tipo&&(l=l.map(e=>(e.id==t&&(e.miembro_id=a.movimiento.miembro_id,e.cantidad=a.movimiento.cantidad,e.tipo=a.movimiento.tipo,e.quien=a.movimiento.quien,e.concepto_id=a.movimiento.concepto_id,e.descripcion=a.movimiento.descripcion,e.fecha=a.movimiento.fecha,e.actualizador_id=a.movimiento.actualizador_id,e.miembro=a.movimiento.miembro,e.tipo_nombre=a.movimiento.tipo_nombre,e.paraquien=a.movimiento.paraquien,e.fecha_date=a.movimiento.fecha_date,e.fecha_hora=a.movimiento.fecha_hora),e)))}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;T(t).then(()=>{b.forEach(e=>{D(e)}),s.forEach(e=>{I(e)})})})}(e)).then(()=>{N("Movimiento modificado correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),P()},1500)}).catch(()=>{N("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(F):async function(e){C(e).then($()).then(async function(e){(async function(e){const{grupo_id:t,miembro_id:n,cantidad:a,tipo:o,quien:i,concepto_id:c,descripcion:r,fecha:d,creador_id:s}=e,u=new FormData;u.append("grupo_id",t),u.append("miembro_id",n),u.append("cantidad",a),u.append("tipo",o),u.append("quien",i),u.append("concepto_id",c),u.append("descripcion",r),u.append("fecha",d),u.append("creador_id",s);try{const e="/api/movimiento/crear",t=await fetch(e,{method:"POST",body:u}),n=await t.json();"exito"==n.tipo&&(l=[...l,n.movimiento])}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;T(t).then(()=>{b.forEach(e=>{D(e)}),s.forEach(e=>{I(e)})})})}(e)).then(()=>{N("Movimiento agregado correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),P()},1500)}).catch(()=>{N("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(F))}var y,v,_,w,S,E,q})),document.querySelector(".dashboard").appendChild(u)}function N(e,t,n){const a=document.querySelector(".alerta");a&&a.remove();const o=document.createElement("DIV");o.classList.add("alerta",t),o.textContent=e,n.parentElement.insertBefore(o,n.nextElementSibling),setTimeout(()=>{o.remove()},1500)}async function C(e,t=!1){const{miembro_id:n,cantidad:a,tipo:o,quien:i}=e,r=i.split(",");let d=a;if(2==o&&(d*=-1),s.forEach(e=>{e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+d,e.saldo=Number(e.saldo)+d)}),1==o||2==o){let e=0;c.forEach(t=>{r.includes(t.id)&&(e+=Number(t.peso))}),s.forEach(t=>{if(r.includes(t.miembro_id)){let n=0;c.forEach(e=>{e.id==t.miembro_id&&(n=Number(e.peso))}),t.gastos=Number(t.gastos)+d*n/e,t.saldo=Number(t.saldo)-d*n/e}})}3==o&&s.forEach(e=>{r.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-d,e.saldo=Number(e.saldo)-d)})}function $(){b=[],f=0,g=0,y=0,v=0,_=JSON.parse(JSON.stringify(s));let e,t=F(_),n=0;for(;t&&n<100;)i=Math.abs(f)>Math.abs(g)?Math.abs(g):Math.abs(f),i>1e-6&&0!=v&&0!=y&&(e={miembro_id:v,cantidad:i,tipo:3,quien:y.toString()},_=j(_,e),b.push(e)),n++,f=0,g=0,y=0,v=0,t=F(_);return!t||(console.log("Error de programación, saldar deudas ha entrado en un bucle"),!1)}function j(e,t){const{miembro_id:n,cantidad:a,tipo:o,quien:i}=t,c=i.split(",");let r=a;return e=e.map(e=>(e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+r,e.saldo=Number(e.saldo)+r),e)),3==o&&(e=e.map(e=>(c.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-r,e.saldo=Number(e.saldo)-r),e))),e}async function T(e){const t=new FormData;t.append("grupo_id",e);try{const e="/api/deuda/eliminar",n=await fetch(e,{method:"POST",body:t});await n.json()}catch(e){console.log(e)}}async function D(e){const{miembro_id:t,cantidad:n,quien:o}=e,i=new FormData;i.append("grupo_id",a.id),i.append("from_miembro_id",t),i.append("to_miembro_id",o),i.append("importe",n);try{const e="/api/deuda/crear",t=await fetch(e,{method:"POST",body:i});await t.json()}catch(e){console.log(e)}}async function I(e){const{id:t,grupo_id:n,miembro_id:o,gastos:i,ingresos:c,saldo:r}=e,d=new FormData;d.append("id",t),d.append("grupo_id",a.id),d.append("miembro_id",o),d.append("gastos",i),d.append("ingresos",c),d.append("saldo",r);try{const e="/api/saldo/actualizar",t=await fetch(e,{method:"POST",body:d});await t.json()}catch(e){console.log(e)}}function P(e=""){!function(){const e=document.querySelector("#listado-txs");for(;e.firstChild;)e.removeChild(e.firstChild)}(),""==e&&function(){const e=document.getElementById("mvtos_de");var t=e.selectedIndex,n=e.options[t];u="T"==n.value?l:l.filter(e=>e.miembro_id==n.value)}();const t=document.querySelector("#listado-txs");if(0==u.length){const e=document.createElement("LI");e.textContent="No hay movimientos",e.classList.add("no-txs"),t.appendChild(e)}else u.forEach(e=>{const n=document.createElement("LI");n.dataset.movtoId=e.id,n.classList.add("tx");const a=document.createElement("P");let o=O(e.cantidad,2);a.textContent=`\n                    ${e.miembro.nombre} \n                    realizó un ${e.tipo_nombre} \n                    de ${o} \n                    por ${e.descripcion}\n                    el dia ${e.fecha_date}\n                    a las ${e.fecha_hora}\n                `;const i=document.createElement("DIV");i.classList.add("opciones");const c=document.createElement("BUTTON");c.classList.add("editar-mvto"),c.dataset.movtoId=e.id,c.textContent="Editar",c.onclick=function(){k(!0,{...e})};const r=document.createElement("BUTTON");r.classList.add("eliminar-mvto"),r.dataset.movtoId=e.id,r.textContent="Eliminar",r.onclick=function(){!function(e){Swal.fire({title:"¿Eliminar movimiento?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(t=>{t.isConfirmed?async function(e){e.cantidad=-1*e.cantidad,C(e).then($()).then(async function(e){(async function(e,t=!0){const{id:n}=e,a=new FormData;a.append("id",n);try{const e="/api/movimiento/eliminar",o=await fetch(e,{method:"POST",body:a}),i=await o.json();t&&Swal.fire("Eliminado",i.mensaje,"success"),"exito"==i.tipo&&(l=l.filter(e=>e.id!==n),P())}catch(e){console.log(e)}})(e,!1).then(()=>{const{grupo_id:t}=e;T(t).then(()=>{b.forEach(e=>{D(e)}),s.forEach(e=>{I(e)})})})}(e)).then(()=>{Swal.fire("Movimiento eliminado correctamente"),P()}).catch(()=>{Swal.fire("Error","Ha habido un error en la actualización de tablas")})}(e):Swal.fire("No se ha eliminado el movimiento","","info")})}({...e})},i.appendChild(c),i.appendChild(r),n.appendChild(a),n.appendChild(i),t.appendChild(n)})}function F(e){let t=!1;return e.forEach(e=>{0!=Number(e.saldo)&&(t=!0,Number(e.saldo)>f&&(f=Number(e.saldo),y=e.miembro_id),Number(e.saldo)<g&&(g=Number(e.saldo),v=e.miembro_id))}),t}function O(e,t){return parseFloat(parseFloat(e).toFixed(t)).toString()}w&&async function(){const e=await Promise.all([S(),E(),q(),L(n.value),x()]);c=await e[0],r=await e[1],d=await e[2],a=await e[3],s=await e[4],async function(){try{const e="/api/movimientos?url="+n.value,t=await fetch(e),a=await t.json();l=a.movimientos,P()}catch(e){console.log(e)}}(),w.addEventListener("click",(function(){k(!1)}));const t=document.querySelectorAll("#mvtos_de");t&&t.forEach(e=>{e.addEventListener("change",(function(e){!function(e){u="T"!==e?l.filter(t=>t.miembro_id==e):l,P(e)}(e.target.value)}))})}()}()}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";n(592),n(999),n(235),n(354),n(155),n(724)})()})();
//# sourceMappingURL=main.js.map

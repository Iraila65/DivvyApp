(()=>{var e={724:()=>{!function(){const e=document.querySelector(".grupo-conectado"),t=document.querySelector(".dashboard__grafica");let n=[];t&&async function(){const t="/api/movimientos/gastos?url="+e.value,o=await fetch(t),a=await o.json(),i=Object.values(a),c=i[0],s=i[1],r=i[2],d=i[3],l=i[4],u=Object.keys(c),m=[],p=[],h=[],b=[],f=[],g=[];let v=l.reduce((e,t)=>{const{concepto:n,importe:o}=t;return e[n]=(e[n]||0)+o,e},{});const y=Object.keys(v),_=Object.values(v);let w=l.reduce((e,t)=>{const{nombre:n,importe:o}=t;return e[n]=(e[n]||0)+o,e},{});const S=Object.keys(w),E=Object.values(w);s.forEach(e=>{const t={label:e.nombre,data:e.importes,borderWidth:2,borderRadius:5,borderSkipped:!1};m.push(t),h.push(e.nombre);const n={label:e.nombre,data:e.importesMeses};f.push(n)}),r.forEach(e=>{const t={label:e.concepto,data:e.importes,borderWidth:2,borderRadius:5,borderSkipped:!1};p.push(t);const n={label:e.concepto,data:e.importesMeses};g.push(n)}),d.forEach(e=>{b.push(e.mes)});const L=document.getElementById("grafica-totales-categoria");new Chart(L,{type:"doughnut",data:{labels:y,datasets:[{label:"cantidad gastada",data:_,borderWidth:2,borderRadius:5,borderSkipped:!1}]},options:{animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Totales por categoría",font:{size:20}}}}});const q=document.getElementById("grafica-totales-miembros");new Chart(q,{type:"doughnut",data:{labels:S,datasets:[{label:"cantidad gastada",data:E,borderWidth:2,borderRadius:5,borderSkipped:!1}]},options:{animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Totales por miembro",font:{size:20}}}}});const x=document.getElementById("grafica-desglose-miembro");new Chart(x,{type:"bar",data:{labels:u,datasets:m},options:{scales:{y:{beginAtZero:!0}},animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Desglose por miembro",font:{size:20}}}}});const C=document.getElementById("grafica-desglose-categoria");new Chart(C,{type:"bar",data:{labels:h,datasets:p},options:{scales:{y:{beginAtZero:!0}},animation:!0,responsive:!0,plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Desglose por categoría",font:{size:20}}}}});const k=document.getElementById("grafica-serie-mensual-miembros");new Chart(k,{type:"line",data:{labels:b,datasets:f},options:{scales:{y:{beginAtZero:!0},x:{ticks:{align:"start"}}},animations:{radius:{duration:400,easing:"linear",loop:e=>e.active}},hoverRadius:12,hoverBackgroundColor:"yellow",interaction:{mode:"nearest",intersect:!1,axis:"x"},responsive:!0,elements:{line:{tension:.4}},plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Serie mensual gastos de miembros",font:{size:20}}}}});const $=document.getElementById("grafica-serie-mensual-categorias");new Chart($,{type:"line",data:{labels:b,datasets:g},options:{scales:{y:{beginAtZero:!0},x:{ticks:{align:"start"}}},animations:{radius:{duration:400,easing:"linear",loop:e=>e.active}},hoverRadius:12,hoverBackgroundColor:"yellow",interaction:{mode:"nearest",intersect:!1,axis:"x"},responsive:!0,elements:{line:{tension:.4}},plugins:{legend:{position:"top",labels:{font:{size:14}}},tooltip:{enabled:!0},title:{display:!0,text:"Serie mensual gastos por categorías",font:{size:20}}}}});const T=document.createElement("DIV");T.classList.add("filtros-inputs");const N=document.createElement("H2");N.textContent="Filtros: ",T.appendChild(N);const j=document.createElement("DIV");j.classList.add("campo");const I=document.createElement("LABEL");I.textContent="Miembro: ",j.appendChild(I);const D=document.createElement("SELECT");D.id="detalle_de",D.classList.add("miembro__select"),D.innerHTML=`                     \n                <select>\n                    <option value="T" 'selected'> Todos </option>\n                    ${s.map(e=>`\n                        <option value="${e.miembro_id}">${e.nombre}</option>\n                        `).join("")}\n                </select>  \n            `,D.addEventListener("change",(function(e){A()})),j.appendChild(D),T.appendChild(j);const P=document.createElement("DIV");P.classList.add("campo");const F=document.createElement("LABEL");F.textContent="Categoría: ",P.appendChild(F);const O=document.createElement("SELECT");O.id="detalle_concepto",O.classList.add("concepto__select"),O.innerHTML=`   \n                <select>\n                    <option value="T" 'selected'> Todas </option>\n                    ${r.map(e=>`\n                        <option value="${e.concepto}">${e.concepto}</option>\n                        `).join("")}\n                </select>                      \n            `,O.addEventListener("change",(function(e){A()})),P.appendChild(O),T.appendChild(P);const z=document.createElement("DIV");z.classList.add("campo");const B=document.createElement("LABEL");B.textContent="Mes: ",z.appendChild(B);const M=document.createElement("SELECT");function A(){!function(){const e=document.querySelector("#listado-detalle");for(;e.firstChild;)e.removeChild(e.firstChild)}(),function(){const e=document.querySelector("#detalle_de");var t=e.selectedIndex,o=e.options[t];n="T"==o.value?l:l.filter(e=>e.miembro==o.value);const a=document.querySelector("#detalle_concepto");var i=a.selectedIndex,c=a.options[i];"T"!==c.value&&(n=n.filter(e=>e.concepto==c.value));const s=document.querySelector("#detalle_mes");var r=s.selectedIndex,d=s.options[r];"T"!==d.value&&(n=n.filter(e=>e.mes==d.value))}();const e=document.querySelector("#listado-detalle");if(0==n.length){const t=document.createElement("P");t.textContent="No hay movimientos con estos filtros",t.classList.add("no-txs"),e.appendChild(t)}else{const t=document.createElement("TABLE");t.classList.add("table"),t.innerHTML=`\n                        <thead class="table__thead">\n                            <tr>\n                                <th scope="col" class="table__th">Nombre</th>\n                                <th scope="col" class="table__th">Concepto</th>\n                                <th scope="col" class="table__th">Mes</th>\n                                <th scope="col" class="table__th">Importe</th>\n                            </tr>\n                        </thead>\n    \n                        <tbody class="table__tbody">\n                            ${n.map(e=>`\n                                <tr class="table__tr">\n                                    <td class="table__td">\n                                        ${e.nombre}\n                                    </td>\n                                    <td class="table__td">\n                                        ${e.concepto}\n                                    </td>\n                                    <td class="table__td">\n                                        ${e.mes}\n                                    </td>\n                                    <td class="table__td">\n                                        ${parseFloat(parseFloat(e.importe).toFixed(2)).toString()}\n                                    </td>\n                                </tr>\n                            `).join("")}\n                        </tbody>\n                    `,e.appendChild(t)}}M.id="detalle_mes",M.classList.add("mes__select"),M.innerHTML=`   \n                <select>\n                    <option value="T" 'selected'> Todos </option>\n                    ${d.map(e=>`\n                        <option value="${e.mes}">${e.mes}</option>\n                        `).join("")}\n                </select>                      \n            `,M.addEventListener("change",(function(e){A()})),z.appendChild(M),T.appendChild(z),document.querySelector("#filtros-detalle").appendChild(T),A()}()}()},592:()=>{!function(){const e=document.querySelectorAll(".circle"),t=document.querySelector(".color-seleccionado");e&&e.forEach(e=>{e.addEventListener("click",(function(n){const o=document.querySelector(".color-marcado");o&&o.classList.remove("color-marcado"),t.value=n.target.id,e.classList.add("color-marcado")}))})}()},354:()=>{!function(){const e=document.querySelector(".usuario-conectado"),t=(document.querySelector(".nombre-usuario"),document.querySelector(".propietario-grupo"),document.querySelector(".grupo-conectado"));let n,o,a,i=[],c=[],s=[],r=[],d=[],l=[],u=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),m=0,p=[],h=0,b=0,f=0,g=0,v=[];async function y(){try{const e="/api/miembros-activos?url="+t.value,n=await fetch(e);return(await n.json()).miembros}catch(e){console.log(e)}}async function _(){try{const e="/api/conceptos",t=await fetch(e);return(await t.json()).conceptos}catch(e){console.log(e)}}async function w(){try{const e="/api/tipos",t=await fetch(e);return(await t.json()).tipos}catch(e){console.log(e)}}async function S(e){try{const t="/api/grupo/getGrupo?url="+e,n=await fetch(t);return(await n.json()).grupo}catch(e){console.log(e)}}async function E(){try{const e="/api/saldos?url="+t.value,n=await fetch(e);return(await n.json()).saldos}catch(e){console.log(e)}}function L(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const a=document.createElement("DIV");a.classList.add("alerta",t),a.textContent=e,n.parentElement.insertBefore(a,n.nextElementSibling),setTimeout(()=>{a.remove()},1500)}function q(e,t){const{miembro_id:n,cantidad:o,tipo:a,quien:i}=t,c=i.split(",");let s=o;return e=e.map(e=>(e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+s,e.saldo=Number(e.saldo)+s),e)),3==a&&(e=e.map(e=>(c.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-s,e.saldo=Number(e.saldo)-s),e))),e}async function x(){try{const y="/api/deudas?url="+t.value,_=await fetch(y),w=await _.json();d=w.deudas,function(){!function(){const e=document.querySelector("#listado-deudas");for(;e.firstChild;)e.removeChild(e.firstChild)}();const t=document.querySelector("#listado-deudas");if(0==d.length){const e=document.createElement("LI");e.textContent="No hay deudas",e.classList.add("no-deudas","animate__animated","animate__rubberBand"),t.appendChild(e)}else d.forEach(d=>{const y=document.createElement("LI");y.classList.add("deuda");const _=document.createElement("P");_.classList.add("animate__animated","animate__lightSpeedInLeft"),_.textContent=d.from_miembro.nombre,y.appendChild(_);const w=document.createElement("DIV");w.classList.add("flecha","saldar-deuda","animate__animated","animate__bounce"),w.id="saldar-deuda";const S=document.createElement("SPAN"),E=k(d.importe,2);S.textContent=`debe ${E} € a`,w.appendChild(S),w.onclick=function(){!function(t={}){u=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1});let d=function(e){const t=e.toString().split(".");return 1===t.length||"0"===t[1]?0:t[1].replace(/0+$/,"").length}(t.importe);m=k(t.importe,d);const y=document.createElement("DIV");y.classList.add("modal");const _=document.createElement("FORM");_.classList.add("formulario"),_.classList.add("nueva-tx"),_.innerHTML=`\n                <legend>Saldar Deuda</legend>\n                <div class="campo">\n                    <label>Quién?</label>                        \n                    <select \n                        name="miembro_id" \n                        id="miembro_id"\n                        class="miembro__select"\n                        disabled\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${i.map(e=>`\n                        <option ${e.id==t.from_miembro_id?"selected":""}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>realiza un </label>                        \n                    <select \n                        name="tipo_id" \n                        id="tipo_id"\n                        class="tipo__select"\n                        disabled\n                    >\n                    ${c.map(e=>`\n                        <option ${"Transferencia"==e.nombre?"selected":""}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Importe: </label>\n                    <input \n                        type="number" \n                        name="cantidad" \n                        id="cantidad"\n                        value="${m}"\n                        readonly\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Concepto: </label>\n                    <input \n                        type="text" \n                        name="descripcion" \n                        id="descripcion"\n                        value="Saldar deuda"\n                        readonly\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Para quién?</label>   \n\n                    <div class="cajas-para">\n                    \n                        ${i.map(e=>`\n                            <div class="miembro-para">\n                                <input \n                                    type="checkbox" \n                                    class="for-whom ${t.to_miembro_id==e.id?"check":""}"\n                                    name="" \n                                    value="${e.id}"\n                                    disabled\n                                >\n                                ${e.nombre}\n                            </div> \n                            `).join("")}\n                \n                    </div>    \n                </div>\n\n                <div class="campo">\n                    <label>Fecha: </label>\n                    <div class="flatpickr">\n                        <input \n                            class="datePicker"\n                            id="datePicker"\n                            name="datePicker"\n                            type="text" \n                            value="${u}"\n                            placeholder="Selecciona una fecha"\n                            data-input \n                        >\n                        <a class="input-button" title="toggle" data-toggle>\n                            <i class="icon-calendar fa-solid fa-calendar"></i>\n                        </a>\n\n                        <a class="input-button" title="clear" data-clear>\n                            <i class="icon-close fa-solid fa-rectangle-xmark"></i>\n                        </a>  \n                    </div>\n                    \n                </div>\n\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nueva-tx" \n                        value="Saldar deuda" \n                    >\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        `,setTimeout(()=>{_.classList.add("animar")},0),y.appendChild(_),y.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("cerrar-modal")&&(_.classList.add("cerrar"),setTimeout(()=>{y.remove()},500)),t.target.classList.contains("for-whom")&&(t.target.classList.contains("check")?(t.target.classList.remove("check"),t.target.classList.add("nocheck")):(t.target.classList.remove("nocheck"),t.target.classList.add("check"))),t.target.classList.contains("datePicker")){const e=document.querySelector(".flatpickr");flatpickr(e,{enableTime:!0,dateFormat:"Y-m-d H:i",wrap:!0,allowInput:!0,altInput:!0,altFormat:"Y-m-d H:i",defaultDate:"today",time_24hr:!0,onChange:function(e,t,n){o=t}}).toggle()}if(t.target.classList.contains("submit-nueva-tx")){l=[];const t=document.querySelectorAll(".for-whom");t&&t.forEach(e=>{e.classList.contains("check")&&(l=[...l,e.value])});const y=document.querySelector("#cantidad").value,_=Number(y.replace(",",".")),I=document.getElementById("miembro_id");var c=I.selectedIndex,d=I.options[c];const D=document.getElementById("tipo_id");var m=D.selectedIndex,w=D.options[m];const P=document.querySelector("#descripcion").value;o&&""!=o||(E=(S=u.split(/[\/,: ]/))[0],k=S[1],$=S[2],T=S[4],N=S[5],$=(j=new Date($,k-1,E,T,N)).getFullYear(),(k=j.getMonth()+1)<10&&(k="0"+k),(E=j.getDate())<10&&(E="0"+E),(T=j.getHours())<10&&(T="0"+T),(N=j.getMinutes())<10&&(N="0"+N),o=$+"-"+k+"-"+E+" "+T+":"+N);let F={};F={grupo_id:n.id,miembro_id:d.value,cantidad:_,tipo:w.value,quien:l.toString(),concepto_id:"",descripcion:P,fecha:o,creador_id:e.value};(function(e){let t=!0;var n;return 0==l.length&&(swal.fire("¿Para quién es la transacción? al menos debes seleccionar un miembro","","error"),t=!1),0!=(""!=(n=e.cantidad)&&!!/^\d*([.,]?\d+)?$/.test(n))&&0!=e.cantidad||(swal.fire("La cantidad debe ser numérica y mayor que cero","","error"),t=!1),3==e.tipo&&l.includes(e.miembro_id)&&(swal.fire("No se puede saldar deuda con uno mismo","","error"),t=!1),3==e.tipo&&l.length>1&&(swal.fire("Para saldar deuda debes seleccionar sólo un destinatario","","error"),t=!1),""==e.descripcion&&(swal.fire("El concepto es obligatorio","","error"),t=!1),t})(F)&&async function(e){(async function(e,t=!1){const{miembro_id:n,cantidad:o,tipo:a,quien:c}=e,r=c.split(",");let d=o;if(2==a&&(d*=-1),s.forEach(e=>{e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+d,e.saldo=Number(e.saldo)+d)}),1==a||2==a){let e=0;i.forEach(t=>{r.includes(t.id)&&(e+=Number(t.peso))}),s.forEach(t=>{if(r.includes(t.miembro_id)){let n=0;i.forEach(e=>{e.id==t.miembro_id&&(n=Number(e.peso))}),t.gastos=Number(t.gastos)+d*n/e,t.saldo=Number(t.saldo)-d*n/e}})}3==a&&s.forEach(e=>{r.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-d,e.saldo=Number(e.saldo)-d)})})(e).then(function(){p=[],h=0,b=0,f=0,g=0,v=JSON.parse(JSON.stringify(s));let e,t=C(v),n=0;for(;t&&n<100;)a=Math.abs(h)>Math.abs(b)?Math.abs(b):Math.abs(h),a>1e-6&&0!=g&&0!=f&&(e={miembro_id:g,cantidad:a,tipo:3,quien:f.toString()},v=q(v,e),p.push(e)),n++,h=0,b=0,f=0,g=0,t=C(v);return!t||(console.log("Error de programación, saldar deudas ha entrado en un bucle"),!1)}()).then(async function(e){(async function(e){const{grupo_id:t,miembro_id:n,cantidad:o,tipo:a,quien:i,concepto_id:c,descripcion:s,fecha:d,creador_id:l}=e,u=new FormData;u.append("grupo_id",t),u.append("miembro_id",n),u.append("cantidad",o),u.append("tipo",a),u.append("quien",i),u.append("concepto_id",c),u.append("descripcion",s),u.append("fecha",d),u.append("creador_id",l);try{const e="/api/movimiento/crear",t=await fetch(e,{method:"POST",body:u}),n=await t.json();"exito"==n.tipo&&(r=[...r,n.movimiento])}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;(async function(e){const t=new FormData;t.append("grupo_id",e);try{const e="/api/deuda/eliminar",n=await fetch(e,{method:"POST",body:t});await n.json()}catch(e){console.log(e)}})(t).then(()=>{p.forEach(e=>{!async function(e){const{miembro_id:t,cantidad:o,quien:a}=e,i=new FormData;i.append("grupo_id",n.id),i.append("from_miembro_id",t),i.append("to_miembro_id",a),i.append("importe",o);try{const e="/api/deuda/crear",t=await fetch(e,{method:"POST",body:i});await t.json()}catch(e){console.log(e)}}(e)}),s.forEach(e=>{!async function(e){const{id:t,grupo_id:o,miembro_id:a,gastos:i,ingresos:c,saldo:s}=e,r=new FormData;r.append("id",t),r.append("grupo_id",n.id),r.append("miembro_id",a),r.append("gastos",i),r.append("ingresos",c),r.append("saldo",s);try{const e="/api/saldo/actualizar",t=await fetch(e,{method:"POST",body:r});await t.json()}catch(e){console.log(e)}}(e)})})})}(e)).then(()=>{L("Deuda saldada correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),x()},1500)}).catch(()=>{L("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(F)}var S,E,k,$,T,N,j})),document.querySelector(".dashboard").appendChild(y)}(d)},y.appendChild(w);const $=document.createElement("P");$.classList.add("animate__animated","animate__lightSpeedInRight"),$.textContent=d.to_miembro.nombre,y.appendChild($),t.appendChild(y)})}()}catch(e){console.log(e)}}function C(e){let t=!1;return e.forEach(e=>{0!=Number(e.saldo)&&(t=!0,Number(e.saldo)>h&&(h=Number(e.saldo),f=e.miembro_id),Number(e.saldo)<b&&(b=Number(e.saldo),g=e.miembro_id))}),t}function k(e,t){return parseFloat(parseFloat(e).toFixed(t)).toString()}document.querySelectorAll("#saldar-deuda")&&async function(){const e=await Promise.all([y(),_(),w(),S(t.value),E()]);i=await e[0],conceptos=await e[1],c=await e[2],n=await e[3],s=await e[4],x()}()}()},999:()=>{!function(){const e=document.querySelector("#mobile-menu"),t=document.querySelector("#cerrar-menu"),n=document.querySelector(".sidebar");e&&e.addEventListener("click",(function(){n.classList.toggle("mostrar")})),t&&t.addEventListener("click",(function(){n.classList.add("ocultar"),setTimeout(()=>{n.classList.remove("mostrar"),n.classList.remove("ocultar")},1e3)})),window.addEventListener("resize",(function(){document.body.clientWidth>=768&&n.classList.remove("mostrar")}))}()},155:()=>{!function(){const e=document.querySelectorAll(".table__accion--editar"),t=document.querySelectorAll(".table__accion--boton"),n=document.querySelectorAll(".usuario-id"),o=document.querySelector(".usuario-conectado"),a=document.querySelector(".propietario-grupo"),i=document.querySelector(".grupo-conectado"),c=document.querySelectorAll(".check-usuario"),s=document.querySelectorAll(".check-activo"),r=document.querySelectorAll(".peso-miembro"),d=document.querySelector(".soy-yo");if(e)for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){var n;0!=(n=Number(r[t].textContent.replace(",",".")),!!/^\d*([.,]?\d+)?$/.test(n))?l({id:e.target.value,peso:Number(r[t].textContent.replace(",",".")).toFixed(1)}):swal.fire("El peso debe ser numérico","","error")}));if(t)for(let e=0;e<t.length;e++)t[e].addEventListener("click",(function(t){t.target.classList.contains("table__accion--eliminar")?n[e].value==a.value?swal.fire("El propietario no se puede eliminar","","error"):u(t.target.value):t.target.classList.contains("table__accion--inactivar")&&(1==s[e].checked?m({id:this.value,activo:0}):m({id:this.value,activo:1}))}));async function l(e){const{id:t,peso:n}=e,o=new FormData;o.append("id",t),o.append("peso",n);try{const e="/api/miembro/actualizarPeso",t=await fetch(e,{method:"POST",body:o}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}async function u(e){const t=new FormData;t.append("id",e),t.append("url",i.value);try{const e="/api/miembro/eliminar",n=await fetch(e,{method:"POST",body:t}),o=await n.json();swal.fire(o.mensaje,"","exito"==o.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}async function m(e){const{id:t,activo:n}=e,o=new FormData;o.append("id",t),o.append("activo",n);try{const e="/api/miembro/actualizarActivo",t=await fetch(e,{method:"POST",body:o}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}d?c&&c.forEach(e=>e.disabled=!0):c&&c.forEach(e=>{e.addEventListener("change",(function(e){if(this.checked){const e=document.querySelector(".soy-yo");e&&(e.classList.remove("soy-yo"),e.checked=!1),Swal.fire({title:"¿De verdad eres este miembro?",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Que sí",denyButtonText:"No, me equivoqué"}).then(e=>{e.isConfirmed?(this.classList.add("soy-yo"),async function(e){const{id:t,soy_yo:n,usuario_id:o}=e,a=new FormData;a.append("id",t),a.append("soy_yo",n),a.append("usuario_id",o);try{const e="/api/miembro/actualizarSoyYo",t=await fetch(e,{method:"POST",body:a}),n=await t.json();swal.fire(n.mensaje,"","exito"==n.tipo?"success":"error").then(()=>location.href="/miembros?url="+i.value)}catch(e){console.log(e)}}({id:this.value,soy_yo:this.checked,usuario_id:o.value})):e.isDenied&&(this.classList.remove("soy-yo"),this.checked=!1)})}else this.classList.remove("soy-yo")}))})}()},235:()=>{!function(){const e=document.querySelector(".usuario-conectado"),t=document.querySelector(".nombre-usuario"),n=(document.querySelector(".propietario-grupo"),document.querySelector(".grupo-conectado"));let o,a,i,c=[],s=[],r=[],d=[],l=[],u=[],m=[],p=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),h=0,b=[],f=0,g=0,v=0,y=0,_=[];const w=document.querySelector("#agregar-tx");async function S(){try{const e="/api/miembros-activos?url="+n.value,t=await fetch(e);return(await t.json()).miembros}catch(e){console.log(e)}}async function E(){try{const e="/api/conceptos",t=await fetch(e);return(await t.json()).conceptos}catch(e){console.log(e)}}async function L(){try{const e="/api/tipos",t=await fetch(e);return(await t.json()).tipos}catch(e){console.log(e)}}async function q(e){try{const t="/api/grupo/getGrupo?url="+e,n=await fetch(t);return(await n.json()).grupo}catch(e){console.log(e)}}async function x(){try{const e="/api/saldos?url="+n.value,t=await fetch(e);return(await t.json()).saldos}catch(e){console.log(e)}}function C(n=!1,i={}){if(n){p=new Date(i.fecha).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1});let e=function(e){const t=e.toString().split(".");return 1===t.length||"0"===t[1]?0:t[1].replace(/0+$/,"").length}(i.cantidad);h=O(i.cantidad,e)}else p=(new Date).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),h=0;const u=document.createElement("DIV");u.classList.add("modal");const f=document.createElement("FORM");f.classList.add("formulario"),f.classList.add("nueva-tx"),f.innerHTML=`\n                <legend>${n?"Editar transacción":"Añade una nueva transacción"}</legend>\n                <div class="campo">\n                    <label>Quién?</label>                        \n                    <select \n                        name="miembro_id" \n                        id="miembro_id"\n                        class="miembro__select"\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${c.map(e=>`\n                        <option ${n&&e.nombre==i.miembro.nombre?"selected":n||e.nombre!=t.value?"":"selected"}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>realiza un </label>                        \n                    <select \n                        name="tipo_id" \n                        id="tipo_id"\n                        class="tipo__select"\n                    >\n                    ${r.map(e=>`\n                        <option ${n&&e.nombre==i.tipo_nombre?"selected":n||"Gasto"!=e.nombre?"":"selected"}\n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Importe: </label>\n                    <input \n                        type="number" \n                        name="cantidad" \n                        id="cantidad"\n                        value="${n?h:""}"\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Concepto: </label>\n                    <input \n                        type="text" \n                        name="descripcion" \n                        id="descripcion"\n                        value="${n?i.descripcion:""}"\n                    >\n                </div>\n\n                <div class="campo">\n                    <label>Para quién?</label>   \n\n                    <div class="cajas-para">\n                    \n                        ${c.map(e=>`\n                            <div class="miembro-para">\n                                <input \n                                    type="checkbox" \n                                    class="for-whom ${n?n&&i.paraquien.includes(e.id)?"check":"":"check"}"\n                                    name="" \n                                    value="${e.id}"\n                                >\n                                ${e.nombre}\n                            </div> \n                            `).join("")}\n                \n                    </div>    \n                </div>\n\n                <div class="campo">\n                    <label>Categoría:</label>                        \n                    <select \n                        name="concepto_id" \n                        id="concepto_id"\n                        class="concepto__select"\n                    >\n                    <option value=""> -Seleccionar-</option>\n                    ${s.map(e=>`\n                        <option ${n&&e.id==i.concepto_id?"selected":""} \n                            value="${e.id}"\n                        >${e.nombre}</option>\n                        `).join("")}\n                    </select>  \n                </div>\n\n                <div class="campo">\n                    <label>Fecha: </label>\n                    <div class="flatpickr">\n                        <input \n                            class="datePicker"\n                            id="datePicker"\n                            name="datePicker"\n                            type="text" \n                            value="${p}"\n                            placeholder="Selecciona una fecha"\n                            data-input \n                        >\n                        <a class="input-button" title="toggle" data-toggle>\n                            <i class="icon-calendar fa-solid fa-calendar"></i>\n                        </a>\n\n                        <a class="input-button" title="clear" data-clear>\n                            <i class="icon-close fa-solid fa-rectangle-xmark"></i>\n                        </a>  \n                    </div>\n                    \n                </div>\n\n                <div class="campo">\n                    <input \n                        type="hidden" \n                        name="id" \n                        id="id"\n                        value="${n?i.id:""}"\n                    >\n                </div>\n\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nueva-tx" \n                        value="${i.id?"Guardar cambios":"Añadir Transacción"}" \n                    >\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        `,setTimeout(()=>{f.classList.add("animar")},0),u.appendChild(f),u.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("cerrar-modal")&&(f.classList.add("cerrar"),setTimeout(()=>{u.remove()},500)),t.target.classList.contains("for-whom")&&(t.target.classList.contains("check")?(t.target.classList.remove("check"),t.target.classList.add("nocheck")):(t.target.classList.remove("nocheck"),t.target.classList.add("check"))),t.target.classList.contains("datePicker")){const e=document.querySelector(".flatpickr");flatpickr(e,{enableTime:!0,dateFormat:"Y-m-d H:i",wrap:!0,allowInput:!0,altInput:!0,altFormat:"Y-m-d H:i",defaultDate:"today",time_24hr:!0,onChange:function(e,t,n){a=t}}).toggle()}if(t.target.classList.contains("submit-nueva-tx")){m=[];const t=document.querySelectorAll(".for-whom");t&&t.forEach(e=>{e.classList.contains("check")&&(m=[...m,e.value])});const u=document.querySelector("#cantidad").value,f=Number(u.replace(",",".")),q=document.getElementById("miembro_id");var i=q.selectedIndex,c=q.options[i];const x=document.getElementById("tipo_id");var s=x.selectedIndex,r=x.options[s];const C=document.getElementById("concepto_id");var h=C.selectedIndex,g=C.options[h];const N=document.querySelector("#descripcion").value;a&&""!=a||(y=(v=p.split(/[\/,: ]/))[0],_=v[1],w=v[2],S=v[4],E=v[5],w=(L=new Date(w,_-1,y,S,E)).getFullYear(),(_=L.getMonth()+1)<10&&(_="0"+_),(y=L.getDate())<10&&(y="0"+y),(S=L.getHours())<10&&(S="0"+S),(E=L.getMinutes())<10&&(E="0"+E),a=w+"-"+_+"-"+y+" "+S+":"+E);let F={};F=n?{id:document.querySelector("#id").value,grupo_id:o.id,miembro_id:c.value,cantidad:f,tipo:r.value,quien:m.toString(),concepto_id:g.value,descripcion:N,fecha:a,actualizador_id:e.value}:{id:document.querySelector("#id").value,grupo_id:o.id,miembro_id:c.value,cantidad:f,tipo:r.value,quien:m.toString(),concepto_id:g.value,descripcion:N,fecha:a,creador_id:e.value};(function(e){let t=!0;var n;return 0==m.length&&(swal.fire("¿Para quién es la transacción? al menos debes seleccionar un miembro","","error"),t=!1),0!=(""!=(n=e.cantidad)&&!!/^\d*([.,]?\d+)?$/.test(n))&&0!=e.cantidad||(swal.fire("La cantidad debe ser numérica y mayor que cero","","error"),t=!1),3==e.tipo&&m.includes(e.miembro_id)&&(swal.fire("No se puede saldar deuda con uno mismo","","error"),t=!1),3==e.tipo&&m.length>1&&(swal.fire("Para saldar deuda debes seleccionar sólo un destinatario","","error"),t=!1),""==e.descripcion&&(swal.fire("El concepto es obligatorio","","error"),t=!1),t})(F)&&(n?async function(e){const{id:t}=e;let n=JSON.parse(JSON.stringify(function(e){return l.find((function(t){return t.id===e}))}(t)));n.cantidad=-1*n.cantidad,$(n).then($(e)).then(T()).then(async function(e){(async function(e){const{id:t,grupo_id:n,miembro_id:o,cantidad:a,tipo:i,quien:c,concepto_id:s,descripcion:r,fecha:d,actualizador_id:u}=e,m=new FormData;m.append("id",t),m.append("grupo_id",n),m.append("miembro_id",o),m.append("cantidad",a),m.append("tipo",i),m.append("quien",c),m.append("concepto_id",s),m.append("descripcion",r),m.append("fecha",d),m.append("actualizador_id",u);try{const e="/api/movimiento/actualizar",n=await fetch(e,{method:"POST",body:m}),o=await n.json();"exito"==o.tipo&&(l=l.map(e=>(e.id==t&&(e.miembro_id=o.movimiento.miembro_id,e.cantidad=o.movimiento.cantidad,e.tipo=o.movimiento.tipo,e.quien=o.movimiento.quien,e.concepto_id=o.movimiento.concepto_id,e.descripcion=o.movimiento.descripcion,e.fecha=o.movimiento.fecha,e.actualizador_id=o.movimiento.actualizador_id,e.miembro=o.movimiento.miembro,e.tipo_nombre=o.movimiento.tipo_nombre,e.paraquien=o.movimiento.paraquien,e.fecha_date=o.movimiento.fecha_date,e.fecha_hora=o.movimiento.fecha_hora),e)))}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;j(t).then(()=>{b.forEach(e=>{I(e)}),d.forEach(e=>{D(e)})})})}(e)).then(()=>{k("Movimiento modificado correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),P()},1500)}).catch(()=>{k("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(F):async function(e){$(e).then(T()).then(async function(e){(async function(e){const{grupo_id:t,miembro_id:n,cantidad:o,tipo:a,quien:i,concepto_id:c,descripcion:s,fecha:r,creador_id:d}=e,u=new FormData;u.append("grupo_id",t),u.append("miembro_id",n),u.append("cantidad",o),u.append("tipo",a),u.append("quien",i),u.append("concepto_id",c),u.append("descripcion",s),u.append("fecha",r),u.append("creador_id",d);try{const e="/api/movimiento/crear",t=await fetch(e,{method:"POST",body:u}),n=await t.json();"exito"==n.tipo&&(l=[...l,n.movimiento])}catch(e){console.log(e)}})(e).then(()=>{const{grupo_id:t}=e;j(t).then(()=>{b.forEach(e=>{I(e)}),d.forEach(e=>{D(e)})})})}(e)).then(()=>{k("Movimiento agregado correctamente","exito",document.querySelector(".formulario legend"));const e=document.querySelector(".modal");setTimeout(()=>{e.remove(),P()},1500)}).catch(()=>{k("Ha habido un error en la actualización de tablas","error",document.querySelector(".formulario legend"))})}(F))}var v,y,_,w,S,E,L})),document.querySelector(".dashboard").appendChild(u)}function k(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const a=document.createElement("DIV");a.classList.add("alerta",t),a.textContent=e,n.parentElement.insertBefore(a,n.nextElementSibling),setTimeout(()=>{a.remove()},1500)}async function $(e,t=!1){const{miembro_id:n,cantidad:o,tipo:a,quien:i}=e,s=i.split(",");let r=o;if(2==a&&(r*=-1),d.forEach(e=>{e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+r,e.saldo=Number(e.saldo)+r)}),1==a||2==a){let e=0;c.forEach(t=>{s.includes(t.id)&&(e+=Number(t.peso))}),d.forEach(t=>{if(s.includes(t.miembro_id)){let n=0;c.forEach(e=>{e.id==t.miembro_id&&(n=Number(e.peso))}),t.gastos=Number(t.gastos)+r*n/e,t.saldo=Number(t.saldo)-r*n/e}})}3==a&&d.forEach(e=>{s.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-r,e.saldo=Number(e.saldo)-r)})}function T(){b=[],f=0,g=0,v=0,y=0,_=JSON.parse(JSON.stringify(d));let e,t=F(_),n=0;for(;t&&n<100;)i=Math.abs(f)>Math.abs(g)?Math.abs(g):Math.abs(f),i>1e-6&&0!=y&&0!=v&&(e={miembro_id:y,cantidad:i,tipo:3,quien:v.toString()},_=N(_,e),b.push(e)),n++,f=0,g=0,v=0,y=0,t=F(_);return!t||(console.log("Error de programación, saldar deudas ha entrado en un bucle"),!1)}function N(e,t){const{miembro_id:n,cantidad:o,tipo:a,quien:i}=t,c=i.split(",");let s=o;return e=e.map(e=>(e.miembro_id==n&&(e.ingresos=Number(e.ingresos)+s,e.saldo=Number(e.saldo)+s),e)),3==a&&(e=e.map(e=>(c.includes(e.miembro_id)&&(e.ingresos=Number(e.ingresos)-s,e.saldo=Number(e.saldo)-s),e))),e}async function j(e){const t=new FormData;t.append("grupo_id",e);try{const e="/api/deuda/eliminar",n=await fetch(e,{method:"POST",body:t});await n.json()}catch(e){console.log(e)}}async function I(e){const{miembro_id:t,cantidad:n,quien:a}=e,i=new FormData;i.append("grupo_id",o.id),i.append("from_miembro_id",t),i.append("to_miembro_id",a),i.append("importe",n);try{const e="/api/deuda/crear",t=await fetch(e,{method:"POST",body:i});await t.json()}catch(e){console.log(e)}}async function D(e){const{id:t,grupo_id:n,miembro_id:a,gastos:i,ingresos:c,saldo:s}=e,r=new FormData;r.append("id",t),r.append("grupo_id",o.id),r.append("miembro_id",a),r.append("gastos",i),r.append("ingresos",c),r.append("saldo",s);try{const e="/api/saldo/actualizar",t=await fetch(e,{method:"POST",body:r});await t.json()}catch(e){console.log(e)}}function P(e=""){!function(){const e=document.querySelector("#listado-txs");for(;e.firstChild;)e.removeChild(e.firstChild)}(),""==e&&function(){const e=document.getElementById("mvtos_de");var t=e.selectedIndex,n=e.options[t];u="T"==n.value?l:l.filter(e=>e.miembro_id==n.value)}();const t=document.querySelector("#listado-txs");if(0==u.length){const e=document.createElement("LI");e.textContent="No hay movimientos",e.classList.add("no-txs"),t.appendChild(e)}else u.forEach(e=>{const n=document.createElement("LI");n.dataset.movtoId=e.id,n.classList.add("tx");const o=document.createElement("P");let a=O(e.cantidad,2);o.textContent=`\n                    ${e.miembro.nombre} \n                    realizó un ${e.tipo_nombre} \n                    de ${a} \n                    por ${e.descripcion}\n                    el dia ${e.fecha_date}\n                    a las ${e.fecha_hora}\n                `;const i=document.createElement("DIV");i.classList.add("opciones");const c=document.createElement("BUTTON");c.classList.add("editar-mvto"),c.dataset.movtoId=e.id,c.textContent="Editar",c.onclick=function(){C(!0,{...e})};const s=document.createElement("BUTTON");s.classList.add("eliminar-mvto"),s.dataset.movtoId=e.id,s.textContent="Eliminar",s.onclick=function(){!function(e){Swal.fire({title:"¿Eliminar movimiento?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(t=>{t.isConfirmed?async function(e){e.cantidad=-1*e.cantidad,$(e).then(T()).then(async function(e){(async function(e,t=!0){const{id:n}=e,o=new FormData;o.append("id",n);try{const e="/api/movimiento/eliminar",a=await fetch(e,{method:"POST",body:o}),i=await a.json();t&&Swal.fire("Eliminado",i.mensaje,"success"),"exito"==i.tipo&&(l=l.filter(e=>e.id!==n),P())}catch(e){console.log(e)}})(e,!1).then(()=>{const{grupo_id:t}=e;j(t).then(()=>{b.forEach(e=>{I(e)}),d.forEach(e=>{D(e)})})})}(e)).then(()=>{Swal.fire("Movimiento eliminado correctamente"),P()}).catch(()=>{Swal.fire("Error","Ha habido un error en la actualización de tablas")})}(e):Swal.fire("No se ha eliminado el movimiento","","info")})}({...e})},i.appendChild(c),i.appendChild(s),n.appendChild(o),n.appendChild(i),t.appendChild(n)})}function F(e){let t=!1;return e.forEach(e=>{0!=Number(e.saldo)&&(t=!0,Number(e.saldo)>f&&(f=Number(e.saldo),v=e.miembro_id),Number(e.saldo)<g&&(g=Number(e.saldo),y=e.miembro_id))}),t}function O(e,t){return parseFloat(parseFloat(e).toFixed(t)).toString()}w&&async function(){const e=await Promise.all([S(),E(),L(),q(n.value),x()]);c=await e[0],s=await e[1],r=await e[2],o=await e[3],d=await e[4],async function(){try{const e="/api/movimientos?url="+n.value,t=await fetch(e),o=await t.json();l=o.movimientos,P()}catch(e){console.log(e)}}(),w.addEventListener("click",(function(){C(!1)}));const t=document.querySelectorAll("#mvtos_de");t&&t.forEach(e=>{e.addEventListener("change",(function(e){!function(e){u="T"!==e?l.filter(t=>t.miembro_id==e):l,P(e)}(e.target.value)}))})}()}()}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";n(592),n(999),n(235),n(354),n(155),n(724)})()})();
//# sourceMappingURL=main.js.map
